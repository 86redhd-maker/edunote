<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>êµë¬´í–‰ì • Â· ë”°ëœ»í•œ êµì‚¬ìš© MVP+</title>
<meta name="description" content="êµì‚¬ìš© ì§„ë„/ê³„íšÂ·í‰ê°€/ë³´ì¶©Â·í–‰ì‚¬ ë©”ëª¨Â·ì—…ë¬´Â·ìë£Œì‹¤ í†µí•© ë°ëª¨(ì˜¤í”„ë¼ì¸ ë‹¨ì¼ íŒŒì¼)" />
<style>
/* ---------------- Warm Comfortable Theme Tokens ---------------- */
:root{
  --hue: 30; /* warm default */
  --accent: hsl(var(--hue), 45%, 48%);        /* muted warm */
  --accent-strong: hsl(var(--hue), 55%, 42%); /* for primary buttons */
  --bg: #FAF9F6;          /* ivory */
  --surface: #FDFBF7;     /* slightly lighter card bg */
  --card: #FFFFFF;
  --text: #3E3A39;        /* warm dark brown/grey */
  --muted: #7A6E66;
  --border: #E6E0DA;
  --shadow: 0 10px 28px rgba(100, 72, 40, .08);
  --radius: 16px;
  --focus: 0 0 0 3px rgba(216,168,87,.35); /* mustard focus */
}
/* Dark mode â€” warm espresso tone */
[data-theme="dark"]{
  --bg: #2F2A26;          /* espresso */
  --surface: #352F2B;
  --card: #3A3430;
  --text: #EDE9E3;
  --muted: #A29E9A;
  --border: #4A433F;
  --shadow: 0 12px 34px rgba(0,0,0,.4);
  --focus: 0 0 0 3px rgba(234,179,8,.35);
}
/* Theme presets (color only; layout handled via body classes) */
body.theme-classic{ --hue: 212; }   /* deep navy */
body.theme-arcade{ --hue: 265; }    /* soft lilac */
body.theme-soft{ --hue: 170; }      /* sage green */

/* ---------------- Base ---------------- */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family: "Pretendard", ui-rounded, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", "NanumSquare", "Spoqa Han Sans Neo", sans-serif;
  line-height:1.6; letter-spacing: -.2px;
}
a{ color: var(--accent-strong); text-decoration: none }
a:hover{ text-decoration: underline }
:focus-visible{ outline: var(--focus) }

.container{ max-width: 1200px; margin: 0 auto; padding: 10px 20px; }
main{ max-width: 1200px; margin: 24px auto 96px; padding: 0 20px; }
.card{ background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: 14px; }
.grid{ display:grid; gap:14px; grid-template-columns: repeat(12,1fr); }

.btn{ appearance:none; border:1px solid var(--border); background: var(--surface); color: var(--text);
  padding:10px 14px; border-radius: 999px; cursor:pointer; font-weight:700; box-shadow: var(--shadow); transition:.15s;
}
.btn:hover{ transform: translateY(-1px) }
.btn:active{ transform: translateY(0) }
.btn-primary{ background: var(--accent-strong); border:0; color:#fff; box-shadow: 0 10px 22px rgba(216,168,87,.25) }
.input, select, textarea{ width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background: var(--card); color: var(--text) }
label{ font-size:12px; color: var(--muted); display:block; margin-bottom:6px }
.small{ font-size:12px; color: var(--muted) }
.badge{ display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; font-size:12px; border:1px solid var(--border); background: var(--surface) }
.kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: var(--surface); border:1px solid var(--border); padding:2px 6px; border-radius:6px; }

section{ display:none }
section.active{ display:block }

/* ---------------- Navigation Layouts ---------------- */
.navlink{ padding:8px 12px; border-radius: 10px; border:1px solid var(--border); background: var(--surface); cursor:pointer; font-weight:800 }
.navlink.active{ background: var(--accent); color:#fff; border-color: transparent }

/* classic: top nav */
body.theme-classic header.top{
  position: sticky; top:0; z-index:40;
  background: linear-gradient(180deg, rgba(255,253,248,.85), rgba(255,253,248,.65));
  border-bottom:1px solid var(--border); backdrop-filter: blur(6px);
}
body.theme-classic header.top .nav{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 12px }

/* arcade: bottom dock (color only; soft lilac, still warm) */
body.theme-arcade header.top{ display:none }
body.theme-arcade .dock{
  position: fixed; left:50%; transform: translateX(-50%);
  bottom: 14px; z-index:50; background:#ffffffee; border:1px solid var(--border); border-radius: 14px;
  display:flex; gap:6px; padding:8px; box-shadow: var(--shadow);
}
[data-theme="dark"] .dock{ background: #2f2a26ee }

/* soft: left sidebar */
body.theme-soft header.side{ position: fixed; left:0; top:0; bottom:0; width: 220px; border-right:1px solid var(--border);
  background: #fffaf3cc; backdrop-filter: blur(8px); z-index:40;
}
[data-theme="dark"] body.theme-soft header.side{ background: #2f2a26cc }
body.theme-soft .side .inner{ padding: 12px }
body.theme-soft main{ margin-left:220px }

/* ---------------- Widgets ---------------- */
.table{ width:100%; border-collapse: collapse; }
.table th,.table td{ border-bottom:1px solid var(--border); padding:8px 8px; text-align:left; vertical-align: top; }
.table th{ color: var(--muted); font-weight:700; font-size:12px }
.table tr:hover td{ background: var(--surface) }

.calendar{ border:1px solid var(--border); border-radius: var(--radius); overflow:hidden; }
.calendar-header{ display:flex; justify-content: space-between; align-items:center; padding:10px 12px; background: var(--surface); }
.calendar-grid{ display:grid; grid-template-columns: repeat(7,1fr); }
.calendar-grid .day-name, .calendar-grid .cell{ padding:10px; border-bottom:1px solid var(--border); border-right:1px solid var(--border); min-height:90px; }
.calendar-grid .day-name{ background:#fff; font-weight:700; text-align:center; }
.calendar-grid .cell:nth-child(7n){ border-right:0 }
.event{ background: #fff; border:1px solid var(--border); border-left:4px solid var(--accent); border-radius:10px; padding:6px 8px; margin-bottom:6px; font-size:12px; cursor:pointer }

.kanban{ display:grid; gap:12px; grid-template-columns: repeat(3, 1fr) }
.column{ background: var(--card); border:1px solid var(--border); border-radius: var(--radius); padding:10px; min-height:240px }
.task{ background: #fff; border:1px solid var(--border); border-radius:12px; padding:10px; margin-bottom:8px; cursor:grab }
.progress{ height:6px; border-radius:999px; background:#e5e7eb; overflow:hidden; margin-top:8px }
.progress>span{ display:block; height:100%; background: var(--accent) }

.preview{ border:1px solid var(--border); border-radius:12px; padding:8px; background: var(--surface); max-height:320px; overflow:auto }
.file-card{ display:flex; align-items:center; justify-content:space-between; gap:12px; border:1px solid var(--border); border-radius:12px; padding:10px; background: #fff; }
.file-meta{ font-size:12px; color: var(--muted) }
.pin{ color: var(--accent-strong); font-weight:900 }

.chart{ width:100%; height:240px; border:1px solid var(--border); border-radius: var(--radius); background: var(--card); position:relative }
.chart canvas{ width:100%; height:100% }

/* responsive */
@media (max-width: 960px){
  .grid{ grid-template-columns: 1fr }
  .kanban{ grid-template-columns: 1fr }
  body.theme-soft header.side{ width: 200px }
  body.theme-soft main{ margin-left: 200px }
  .dock{ transform: translateX(-50%) scale(.98) }
}

/* select ê°€ì‹œì„± ê°•ì œ: ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë‘ ê¸€ì ë³´ì´ê²Œ */
select.input{
  color: var(--text) !important;
  background-color: var(--card) !important;
  min-height: 36px; /* ë„ˆë¬´ ë‚®ì•„ì„œ ì•ˆ ë³´ì´ëŠ” ê²½ìš° ë°©ì§€ */
  line-height: 1.2;
  opacity: 1;
}
select.input option{
  color: #000; background: #fff;
}
[data-theme="dark"] select.input option{
  color: #EDE9E3; background: #2F2A26;
}
/* ==== SELECT ë¼ë²¨ ê°•ì œ í‘œì‹œ ë³µêµ¬ ==== */
select.input{
  /* ê¸€ì ë³´ì´ê¸° */
  color: var(--text) !important;
  -webkit-text-fill-color: var(--text) !important; /* ì¼ë¶€ í¬ë¡¬/ì—£ì§€ */
  text-shadow: none !important;
  text-indent: 0 !important;

  /* ë°°ê²½/í…Œë‘ë¦¬ ê¸°ë³¸ */
  background-color: var(--card) !important;
  background-image: none !important;

  /* ì‹œìŠ¤í…œ ê¸°ë³¸ UIë¡œ ë˜ëŒë¦¼ (ì»¤ìŠ¤í…€ í™”ì‚´í‘œ/appearance í•´ì œ) */
  appearance: auto !important;
  -webkit-appearance: menulist !important;
  -moz-appearance: menulist !important;

  /* ì•ˆ ë³´ì´ê²Œ ë§Œë“œëŠ” ì†ì„±ë“¤ ë¬´íš¨í™” */
  opacity: 1 !important;
  filter: none !important;

  /* ê°€ì‹œì„± ë³´ì¡° */
  min-height: 36px !important;
  line-height: 1.2 !important;
  padding-right: 28px !important; /* í™”ì‚´í‘œ ê³µê°„ */
  width: 100% !important; /* ë„ˆë¬´ ì¢ì•„ì„œ ë¼ë²¨ì´ ì˜ë¦¬ëŠ” ê²½ìš° ë°©ì§€ */
  font-size: inherit !important;
}

[data-theme="dark"] select.input{
  color: #EDE9E3 !important;
  -webkit-text-fill-color: #EDE9E3 !important;
  background-color: #2F2A26 !important;
}

select.input option{
  color: #111 !important; background: #fff !important;
}
[data-theme="dark"] select.input option{
  color: #EDE9E3 !important; background: #2F2A26 !important;
}
/* ë³´ì¥ì§€ë„ ëª¨ë“œ ë“œë¡­ë‹¤ìš´: ì™¸ë¶€ ìŠ¤íƒ€ì¼ ì˜í–¥ ì™„ì „ ì°¨ë‹¨ + ê¸°ë³¸ê°’ ë³µì› */
#maTable select[data-field="mode"]{
  all: revert;                 /* ìƒì†/ì „ì—­ ê·œì¹™ì„ ê¹”ë”í•˜ê²Œ ë˜ëŒë¦¼ (ê·¼ë³¸ í•´ê²°) */
  font: inherit;
  color: var(--text);
  background: var(--card);
  min-height: 32px;
  padding: 4px 8px;
  border: 1px solid var(--line, #ddd);
  border-radius: 6px;
  width: 100%;
}
[data-theme="dark"] #maTable select[data-field="mode"]{
  color: #EDE9E3;
  background: #2F2A26;
  border-color: #4A433F;
}
/* ë³´ì¥ì§€ë„ ëª¨ë“œ ë“œë¡­ë‹¤ìš´ ì™„ì „ ë¦¬ì…‹ ë° ê°€ì‹œì„± ê°•ì œ */
#maTable select[data-field="mode"] {
  all: unset; /* ì „ì—­ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” */
  font: inherit;
  color: var(--text) !important;
  background-color: var(--card) !important;
  border: 1px solid var(--line, #ccc);
  border-radius: 4px;
  appearance: auto !important;
  -webkit-appearance: menulist !important;
  -moz-appearance: menulist !important;
  -webkit-text-fill-color: currentColor !important;
  padding: 4px 8px;
  min-width: 120px;  /* ë„ˆë¬´ ì¢ì•„ ë¼ë²¨ì´ ì•ˆ ë³´ì´ëŠ” ë¬¸ì œ ë°©ì§€ */
  min-height: 32px;
  box-sizing: border-box;
}

[data-theme="dark"] #maTable select[data-field="mode"] {
  color: #EDE9E3 !important;
  background-color: #2F2A26 !important;
  border-color: #4A433F;
}
/* 1) í‘œëŠ” ìë™ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë˜ëŒë¦¼ */
#maTable, #assTable, #evalTable { table-layout: auto; width: 100%; }

/* 2) ì…ë ¥/ì…€ ê³µí†µ: ì…€ ì•ˆì—ì„œë§Œ ê½‰ ì°¨ê³ , ë°–ìœ¼ë¡œ ì•ˆ íŠ€ì–´ë‚˜ê°€ê²Œ */
#maTable input, #maTable select,
#assTable input, #assTable select,
#evalTable input, #evalTable select {
  width: 100%;
  max-width: 100%;
  height: 34px;
  box-sizing: border-box;
}

/* 3) ëª¨ë“œ ë“œë¡­ë‹¤ìš´ë§Œ ì‚´ì§ ì¢ê²Œ(ë„ˆë¬´ ë„“ì§€ ì•Šê²Œ ê³ ì •) */
#maTable td:nth-child(1) select[data-field="mode"]{
  width: 96px;
  min-width: 90px;
  max-width: 120px;
}

/* 4) ì œëª©/ë‚´ìš© ì¹¸ì€ ë„“ê²Œ ì“°ë˜, í‘œ ë°–ìœ¼ë¡œëŠ” ì•ˆ ë„˜ì¹˜ê²Œ */
#maTable td:nth-child(2) input { min-width: 220px; } /* ì œëª© */
#maTable td:nth-child(7) input { min-width: 220px; } /* ë‚´ìš© */

/* 5) ì‘ì€ ìˆ«ìì¹¸ì€ ìŠ¬ë¦¼í•˜ê²Œ */
#maTable td:nth-child(10) input,
#maTable td:nth-child(11) input,
#maTable td:nth-child(12) input { max-width: 72px; text-align: center; }

/* 6) í‘œ ì»¨í…Œì´ë„ˆê°€ ì¢ì„ ë•ŒëŠ” ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© (íŠ€ì–´ë‚˜ê° ë°©ì§€) */
#maTable-wrapper, #assTable-wrapper, #evalTable-wrapper { overflow-x: auto; }

/* 7) í‰ê°€ íƒ­: ë‹¨ì›/ìˆ˜í–‰ ë“œë¡­ë‹¤ìš´ ìµœì†Œ í­ë§Œ ë³´ì¥ (ë‹¤ë¥¸ ê±´ ìë™) */
#assTable select, #evalTable select { min-width: 120px; }

/* ë³´ì¥ì§€ë„ í‘œ: ìë™ ë ˆì´ì•„ì›ƒ + í•„ë“œ í­ ì•ˆì •í™” */
#maTable { table-layout: auto; width: 100%; }
#maTable input, #maTable select { width:100%; max-width:100%; height:34px; box-sizing:border-box; }

/* ëª¨ë“œ ë“œë¡­ë‹¤ìš´ ìŠ¬ë¦¼ */
#maTable td:nth-child(1) select[data-field="mode"]{ width:92px; min-width:88px; max-width:120px; }

/* ì œëª©/ë‚´ìš© ê¸°ë³¸ í­, ëŒ€ìƒ ë„“ê²Œ */
#maTable td:nth-child(2) input{ min-width:220px; }  /* ì œëª© */
#maTable td:nth-child(6) input{ min-width:220px; }  /* ë‚´ìš© */
#maTable td:nth-child(7) input{ min-width:320px; }  /* ëŒ€ìƒ(í™•ì¥) */

/* ì‚­ì œ ë²„íŠ¼ ì¹¸ */
#maTable td:last-child button{ width:60px; }

/* í‘œê°€ ì¢ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
#maTable-wrapper{ overflow-x:auto; }

/* === ë³´ì¥ì§€ë„ í‘œ: ì—´ í­ ì´ˆê¸°í™”(ì˜ˆì „ nth-child í­ ì§€ì • ë¬´ë ¥í™”) === */
#maTable { table-layout: auto; width: 100%; }
#maTable th, #maTable td { width: auto !important; }

/* ì…ë ¥ í•„ë“œ ê³µí†µ */
#maTable input, #maTable select{
  width: 100%;
  max-width: 100%;
  height: 34px;
  box-sizing: border-box;
}

/* ëª¨ë“œë§Œ ìŠ¬ë¦¼, ëŒ€ìƒì€ ë„‰ë„‰íˆ */
#maTable td:nth-child(1) select[data-field="mode"]{ width: 92px; min-width: 88px; max-width: 120px; }
#maTable td:nth-child(2) input{ min-width: 200px; }  /* ì œëª© */
#maTable td:nth-child(6) input{ min-width: 200px; }  /* ë‚´ìš© */
#maTable td:nth-child(7) input{ min-width: 260px; }  /* ëŒ€ìƒ */
#maTable td:last-child button{ width: 60px; }

/* ì»¨í…Œì´ë„ˆë³´ë‹¤ ë„“ìœ¼ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
#maTable-wrapper{ overflow-x: auto; }

/* 1) ì¹´ë“œ(ë³´ì¥ì§€ë„ ì„¹ì…˜) ë°–ìœ¼ë¡œ ìƒˆì§€ ëª»í•˜ê²Œ */
#minAchvSection, #minAchv, [data-section="min"] {
  position: relative;
  overflow: hidden;         /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ë°–ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ */
  border-radius: 16px;      /* ì¹´ë“œ ëª¨ì–‘ ìœ ì§€ (ì´ë¯¸ ìˆìœ¼ë©´ ìƒëµ) */
}

/* 2) í…Œì´ë¸”ì€ ë˜í¼ ì•ˆì—ì„œë§Œ ì¢Œìš° ìŠ¤í¬ë¡¤ í—ˆìš© */
#maTable-wrapper{
  max-width: 100%;
  overflow-x: auto;         /* ì¢ì€ í™”ë©´ì—ì„œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
  padding-right: 8px;       /* ì˜¤ë¥¸ìª½ ê°€ì¥ìë¦¬ ì—¬ë°± (ë²„íŠ¼ ê²¹ì¹¨ ë°©ì§€) */
}

/* 3) í…Œì´ë¸”ì´ ë¶€ëª¨ í­ì„ ë„˜ì§€ ì•Šë„ë¡ */
#maTable{
  width: 100%;
  table-layout: auto;       /* ìë™ í­ ê³„ì‚°(ê³ ì • ë ˆì´ì•„ì›ƒ ë•Œë¬¸ì— ë„˜ì¹˜ë˜ ê²ƒ ë°©ì§€) */
  border-collapse: collapse;
}
#maTable th, #maTable td{
  padding: 8px;
  white-space: nowrap;      /* ê¸°ë³¸ì€ í•œ ì¤„ í‘œì‹œ */
}
#maTable input, #maTable select{
  width: 100%;
  max-width: 100%;
  min-width: 0;
  height: 34px;
  box-sizing: border-box;
}

/* 4) ì˜¤ë¥¸ìª½ ë§ˆì§€ë§‰(ì‚­ì œ) ì¹¸ì€ ê³ ì • í­ + ë²„íŠ¼ ì •ë ¬ */
#maTable td:last-child{ width: 72px; }
#maTable td:last-child .btn{
  display: block;
  width: 64px;
  margin-left: auto;        /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
  margin-right: 0;
}

/* 5) ë„ˆë¬´ ì¢ì€ í™”ë©´ì—ì„œëŠ” ì¤„ë°”ê¿ˆ í—ˆìš©í•´ ë„˜ì¹¨ ë” ì¤„ì´ê¸° */
@media (max-width: 1200px){
  #maTable th, #maTable td{ white-space: normal; }
}

/* í‰ê°€ í…Œì´ë¸”: ìë™ ë ˆì´ì•„ì›ƒ + í•„ë“œ í­ ì•ˆì •í™” */
#assTable { table-layout:auto; width:100%; }
#assTable input, #assTable select{
  width:100%; max-width:100%; height:34px; box-sizing:border-box;
}

/* ìœ í˜• ë“œë¡­ë‹¤ìš´(ë‹¨ì›/ìˆ˜í–‰) â€” ì „ì—­ ì˜í–¥ ì°¨ë‹¨ + ê¸°ë³¸ í‘œì‹œ ë³´ì¥ */
#assTable select[data-field="type"]{
  all: unset;
  font: inherit;
  color: var(--text) !important;
  background: var(--card) !important;
  border: 1px solid var(--line, #ccc);
  border-radius: 6px;
  appearance: auto !important;
  -webkit-appearance: menulist !important;
  -moz-appearance: menulist !important;
  padding: 4px 8px;
  min-width: 120px;
}

/* ì¢ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
#assTable-wrapper{ overflow-x:auto; } 
/* í‰ê°€ ì„¹ì…˜ì—ì„œ idê°€ assTableì´ ì•„ë‹Œ í‘œ(ì˜› í—¤ë”í‘œ)ëŠ” ê°ì¶¤ */
#assessSection table.table:not(#assTable),
#assess table.table:not(#assTable),
section#assess table.table:not(#assTable) {
  display: none !important;
}  
/* í‰ê°€ ì¹´ë“œ ìì²´ì—ì„œ ë°”ê¹¥ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ */
#assessSection, #assess, section#assess, [data-section="assess"]{
  position: relative;
  overflow: hidden;           /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ë°–ìœ¼ë¡œ ìƒˆì§€ ì•ŠìŒ */
  border-radius: 16px;        /* ì¹´ë“œ ëª¨ì„œë¦¬ ìœ ì§€ (ì´ë¯¸ ìˆìœ¼ë©´ ìƒëµ ê°€ëŠ¥) */
}

/* í‰ê°€ í…Œì´ë¸”ì€ ë˜í¼ ì•ˆì—ì„œë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
#assTable-wrapper{
  max-width: 100%;
  overflow-x: auto;           /* í­ì´ ì¢ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
  padding-right: 8px;         /* ìš°ì¸¡ ë²„íŠ¼ ê²¹ì¹¨ ë°©ì§€ìš© ì—¬ë°± */
}

/* í…Œì´ë¸”ì€ ì¹´ë“œ í­ ì•ˆì—ì„œë§Œ ê·¸ë¦¬ê¸° */
#assTable{
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  border-collapse: collapse;
}
#assTable th, #assTable td{
  padding: 8px;
  white-space: nowrap;        /* í•œ ì¤„ í‘œì‹œ(ë„˜ì¹˜ë©´ ë˜í¼ê°€ ìŠ¤í¬ë¡¤) */
}

/* í™”ë©´ì´ ë§ì´ ì¢ìœ¼ë©´ ì¤„ë°”ê¿ˆ í—ˆìš©í•´ ë„˜ì¹¨ ë” ì¤„ì´ê¸° */
@media (max-width: 1200px){
  #assTable th, #assTable td{ white-space: normal; }
}
/* ë³´ì¥ì§€ë„: ê³¼ëª©(5ì—´) ë” ë„“ê²Œ */
#maTable td:nth-child(5) input{
  min-width: 180px;   /* ì›í•˜ë©´ 200~240pxë¡œ ë” í‚¤ì›Œë„ ë¨ */
  width: 200px;
}

/* (ì°¸ê³ ) ì œëª©/ë‚´ìš©ë„ ì¡°ê¸ˆ ë” ì—¬ìœ  ì£¼ê³  ì‹¶ìœ¼ë©´: */
#maTable td:nth-child(2) input{ min-width: 240px; }
#maTable td:nth-child(6) input{ min-width: 240px; }
  
/* [í‰ê°€] ì¹´ë“œ ë°–ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ + ìŠ¤í¬ë¡¤ì€ ë˜í¼ ì•ˆì—ì„œë§Œ */
#assessSection, #assess, section#assess, [data-section="assess"]{
  position: relative;
  overflow: hidden;
  border-radius: 16px;
}
#assTable-wrapper{
  max-width: 100%;
  overflow-x: auto;
  padding-right: 8px;
}
#assTable{
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  border-collapse: collapse;
}
#assTable th, #assTable td{ padding:8px; white-space: nowrap; }
@media (max-width: 1200px){
  #assTable th, #assTable td{ white-space: normal; }
}

/* [ë³´ì¥ì§€ë„] ì¹´ë“œ ë°–ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ + ìŠ¤í¬ë¡¤ì€ ë˜í¼ ì•ˆì—ì„œ */
#minAchvSection, #minAchv, section#min, [data-section="min"]{
  position: relative;
  overflow: hidden;
  border-radius: 16px;
}
#maTable-wrapper{ max-width:100%; overflow-x:auto; padding-right:8px; }
#maTable{ width:100%; max-width:100%; table-layout:auto; border-collapse:collapse; }
#maTable th, #maTable td{ padding:8px; white-space: nowrap; }
@media (max-width: 1200px){
  #maTable th, #maTable td{ white-space: normal; }
}

/* ë³´ì¥ì§€ë„: ê³¼ëª©(5ì—´) ë„“íˆë˜, ì „ì²´ëŠ” ì¹´ë“œ ì•ˆì— ë¨¸ë¬¼ë„ë¡ */
#maTable td:nth-child(5) input{
  min-width: 160px;   /* ë„ˆë¬´ í¬ë©´ 180~220pxë¡œ ë‹¨ê³„ì ìœ¼ë¡œ ì˜¬ë¦¬ì„¸ìš” */
  width: 190px;
}  
/* í‰ê°€ ì„¹ì…˜ì—ì„œ idê°€ assTableì´ ì•„ë‹Œ í‘œ(ì˜› í—¤ë”í‘œ)ëŠ” ê°ì¶¤ */
#assessSection table.table:not(#assTable),
#assess table.table:not(#assTable),
section#assess table.table:not(#assTable) {
  display: none !important;
}

/* í‰ê°€Â·ë³´ì¶© ì¹´ë“œ ë‚´ë¶€ í…Œì´ë¸”ì´ ë°°ê²½ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ */
#assessSection, #assess, section#assess, [data-section="assess"]{
  position: relative;
  overflow: hidden;           /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ë°–ìœ¼ë¡œ ìƒˆì§€ ì•ŠìŒ */
  border-radius: 16px;        /* ì¹´ë“œ ëª¨ì„œë¦¬ ìœ ì§€ */
}

/* í‰ê°€ í…Œì´ë¸”ì€ ë˜í¼ ì•ˆì—ì„œë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
#assTable-wrapper{
  max-width: 100%;
  overflow-x: auto;           /* í­ì´ ì¢ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
  padding-right: 8px;         /* ìš°ì¸¡ ë²„íŠ¼ ê²¹ì¹¨ ë°©ì§€ìš© ì—¬ë°± */
}

/* í…Œì´ë¸”ì€ ì¹´ë“œ í­ ì•ˆì—ì„œë§Œ ê·¸ë¦¬ê¸° */
#assTable{
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  border-collapse: collapse;
}
#assTable th, #assTable td{
  padding: 8px;
  white-space: nowrap;        /* í•œ ì¤„ í‘œì‹œ(ë„˜ì¹˜ë©´ ë˜í¼ê°€ ìŠ¤í¬ë¡¤) */
}

/* í™”ë©´ì´ ë§ì´ ì¢ìœ¼ë©´ ì¤„ë°”ê¿ˆ í—ˆìš©í•´ ë„˜ì¹¨ ë” ì¤„ì´ê¸° */
@media (max-width: 1200px){
  #assTable th, #assTable td{ white-space: normal; }
}  
/* í‰ê°€ ì„¹ì…˜ì—ì„œ idê°€ assTableì´ ì•„ë‹Œ í‘œ(ì˜› í—¤ë”í‘œ)ëŠ” ê°ì¶¤ */
#assessSection table.table:not(#assTable),
#assess table.table:not(#assTable),
section#assess table.table:not(#assTable) {
  display: none !important;
}

/* í‰ê°€Â·ë³´ì¶© ì¹´ë“œ ë‚´ë¶€ í…Œì´ë¸”ì´ ë°°ê²½ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ */
#assessSection, #assess, section#assess, [data-section="assess"]{
  position: relative;
  overflow: hidden;           /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ë°–ìœ¼ë¡œ ìƒˆì§€ ì•ŠìŒ */
  border-radius: 16px;        /* ì¹´ë“œ ëª¨ì„œë¦¬ ìœ ì§€ */
}

/* í‰ê°€ í…Œì´ë¸”ì€ ë˜í¼ ì•ˆì—ì„œë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
#assTable-wrapper{
  max-width: 100%;
  overflow-x: auto;           /* í­ì´ ì¢ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
  padding-right: 8px;         /* ìš°ì¸¡ ë²„íŠ¼ ê²¹ì¹¨ ë°©ì§€ìš© ì—¬ë°± */
}

/* í…Œì´ë¸”ì€ ì¹´ë“œ í­ ì•ˆì—ì„œë§Œ ê·¸ë¦¬ê¸° */
#assTable{
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  border-collapse: collapse;
}
#assTable th, #assTable td{
  padding: 8px;
  white-space: nowrap;        /* í•œ ì¤„ í‘œì‹œ(ë„˜ì¹˜ë©´ ë˜í¼ê°€ ìŠ¤í¬ë¡¤) */
}
  
/* í™”ë©´ì´ ë§ì´ ì¢ìœ¼ë©´ ì¤„ë°”ê¿ˆ í—ˆìš©í•´ ë„˜ì¹¨ ë” ì¤„ì´ê¸° */
@media (max-width: 1200px){
  #assTable th, #assTable td{ white-space: normal; }
}  
/* í‰ê°€ ì„¹ì…˜ì—ì„œ idê°€ assTableì´ ì•„ë‹Œ í‘œ(ì˜› í—¤ë”í‘œ)ëŠ” ê°ì¶¤ */
#assessSection table.table:not(#assTable),
#assess table.table:not(#assTable),
section#assess table.table:not(#assTable) {
  display: none !important;
}

/* í‰ê°€Â·ë³´ì¶© ì¹´ë“œ ë‚´ë¶€ í…Œì´ë¸”ì´ ë°°ê²½ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ */
#assessSection, #assess, section#assess, [data-section="assess"]{
  position: relative;
  overflow: hidden;           /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ë°–ìœ¼ë¡œ ìƒˆì§€ ì•ŠìŒ */
  border-radius: 16px;        /* ì¹´ë“œ ëª¨ì„œë¦¬ ìœ ì§€ */
}

/* í‰ê°€ í…Œì´ë¸”ì€ ë˜í¼ ì•ˆì—ì„œë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
#assTable-wrapper{
  max-width: 100%;
  overflow-x: auto;           /* í­ì´ ì¢ì„ ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
  padding-right: 8px;         /* ìš°ì¸¡ ë²„íŠ¼ ê²¹ì¹¨ ë°©ì§€ìš© ì—¬ë°± */
}

/* í…Œì´ë¸”ì€ ì¹´ë“œ í­ ì•ˆì—ì„œë§Œ ê·¸ë¦¬ê¸° */
#assTable{
  width: 100%;
  max-width: 100%;
  table-layout: auto;
  border-collapse: collapse;
}
#assTable th, #assTable td{
  padding: 8px;
  white-space: nowrap;        /* í•œ ì¤„ í‘œì‹œ(ë„˜ì¹˜ë©´ ë˜í¼ê°€ ìŠ¤í¬ë¡¤) */
}

/* í™”ë©´ì´ ë§ì´ ì¢ìœ¼ë©´ ì¤„ë°”ê¿ˆ í—ˆìš©í•´ ë„˜ì¹¨ ë” ì¤„ì´ê¸° */
@media (max-width: 1200px){
  #assTable th, #assTable td{ white-space: normal; }
}  

/* ==== Mobile-first ê°œì„  ê³µí†µ ==== */
:root{
  --space-1: .5rem; --space-2: .75rem; --space-3: 1rem; --space-4: 1.25rem;
  --radius: 12px;
}
*{ box-sizing:border-box; touch-action:manipulation }
html{ font-size:16px }
body{ margin:0; line-height:1.45; -webkit-font-smoothing:antialiased; }
img,svg,video{ max-width:100%; height:auto }

/* í—¤ë”/ë‚´ë¹„ ê¸°ë³¸ */
header, .topbar{ position:sticky; top:0; z-index:20; backdrop-filter:saturate(180%) blur(8px); }
header{ background:color-mix(in srgb, Canvas 85%, transparent) }

/* ê°€ë¡œë¡œ ê¸¸ê²Œ ë‚˜ì—´ëœ í•„í„°/ë²„íŠ¼ ë°”ëŠ” í„°ì¹˜ ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
.h-scroll{ display:flex; gap:.5rem; overflow-x:auto; -webkit-overflow-scrolling:touch; padding: var(--space-2) var(--space-3) }
.h-scroll > *{ flex:0 0 auto }

/* ì¹´ë“œ ì„¹ì…˜ ê³µí†µ */
.section, .card{
  background: color-mix(in oklab, Canvas 96%, black 0%);
  border:1px solid color-mix(in oklab, CanvasText 12%, transparent);
  border-radius: var(--radius);
  padding: var(--space-3);
  box-shadow: 0 1px 12px rgba(0,0,0,.04);
  margin-bottom: var(--space-3);
}

/* í¼ ìš”ì†Œ í„°ì¹˜ íƒ€ê¹ƒ í™•ëŒ€ */
button, .btn, input, select, textarea{
  min-height:44px; font:inherit;
}
label{ font-size:.95rem }

/* í…Œì´ë¸” ì•ˆì „ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë˜í¼ */
.table-wrap{ width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; border-radius: var(--radius); }
.table-wrap table{ width:100%; border-collapse: collapse; }

/* ëª¨ë°”ì¼ì—ì„œ í‘œë¥¼ 'ì¹´ë“œ'ì²˜ëŸ¼ ë³´ì—¬ì£¼ê¸° (data-label í•„ìš”) */
@media (max-width: 768px){
  .container{ padding: var(--space-3) }
  .grid{ display:grid; grid-template-columns: 1fr; gap: var(--space-3) }

  /* ì¤‘ë³µ íƒ­/ë„¤ë¹„ê°€ ìˆë‹¤ë©´ í…ìŠ¤íŠ¸í˜• íƒ­ì€ ìˆ¨ê¹€ (í•„ìš” ì‹œ í´ë˜ìŠ¤ ì¡°ì •) */
  .nav--text{ display:none }

  /* í‘œ â†’ ì¹´ë“œí™” */
  table.responsive{ border:0 }
  table.responsive thead{ display:none }
  table.responsive tr{
    display:block;
    background: color-mix(in oklab, Canvas 98%, black 0%);
    border:1px solid color-mix(in oklab, CanvasText 10%, transparent);
    border-radius: var(--radius);
    padding: var(--space-2) var(--space-3);
    margin-bottom: var(--space-2);
  }
  table.responsive td{
    display:grid; grid-template-columns: 9rem 1fr;
    padding: .4rem 0; border:0; border-bottom:1px dotted color-mix(in srgb, CanvasText 15%, transparent);
  }
  table.responsive td:last-child{ border-bottom:0 }
  table.responsive td::before{
    content: attr(data-label);
    font-weight:600; opacity:.75; padding-right: .75rem;
  }

  /* ì•¡ì…˜ë°”/ë²„íŠ¼ ë¬¶ìŒì€ í•œ ì¤„ ë„˜ì¹˜ë©´ ìŠ¤í¬ë¡¤ */
  .actions{ display:flex; gap:.5rem; overflow-x:auto; padding-bottom:.25rem }

  /* ëª¨ë‹¬/íŒì—… í¬ê¸° ë³´ì • */
  .modal{ width: min(100%, 620px); margin:0 auto; inset:auto 0 0 0; border-radius:16px 16px 0 0 }
}

/* iOS safe area ì²˜ë¦¬ (í•˜ë‹¨ ê³ ì • íƒ­ ì“¸ ë•Œ) */
@supports (padding: max(0px)) {
  .safe-bottom{ padding-bottom: max(env(safe-area-inset-bottom), .5rem) }
}

/* í•˜ë‹¨ ê³ ì • íƒ­ë°” (ì„ íƒ ì‚¬í•­) */
@media (max-width: 768px){
  .tabbar{
    position:fixed; bottom:0; left:0; right:0; z-index:30;
    background: color-mix(in oklab, Canvas 92%, black 0%);
    border-top:1px solid color-mix(in oklab, CanvasText 12%, transparent);
  }
  .tabbar ul{ display:grid; grid-template-columns: repeat(7, 1fr); margin:0; padding:.25rem; list-style:none }
  .tabbar a{
    display:grid; place-items:center; gap:.15rem; padding:.5rem 0; font-size:.8rem; text-decoration:none; color:inherit
  }
}
</style>
</head>
<body class="theme-classic" data-theme="light">
<!-- Top header (classic & default) -->
<header class="top" id="headerTop">
  <div class="container">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <div style="display:flex; align-items:center; gap:10px;">
        <div style="width:34px;height:34px;border-radius:10px;background: var(--accent); box-shadow: var(--shadow)"></div>
        <div>
          <div style="font-weight:900">êµë¬´í–‰ì • Â· ë”°ëœ»í•œ êµì‚¬ìš©</div>
          <div class="small">ì˜¤í”„ë¼ì¸ ë‹¨ì¼ íŒŒì¼ Â· localStorage ì €ì¥</div>
        </div>
      </div>
      <nav class="nav" id="navTop">
        <button class="navlink active" data-target="dash">ëŒ€ì‹œë³´ë“œ</button>
        <button class="navlink" data-target="calendar">ì¼ì •</button>
        <button class="navlink" data-target="tasks">ì—…ë¬´</button>
        <button class="navlink" data-target="files">ìë£Œì‹¤</button>
        <button class="navlink" data-target="progress">ì§„ë„</button>
        <button class="navlink" data-target="plans">ê³„íš</button>
        <button class="navlink" data-target="assess">í‰ê°€Â·ë³´ì¶©</button>
        <button class="navlink" data-target="minachv">ë³´ì¥ì§€ë„</button>
        <button class="navlink" data-target="settings">ì„¤ì •</button>
      </nav>
    </div>
  </div>
</header>

<!-- Soft sidebar header -->
<header class="side" id="headerSide" style="display:none">
  <div class="inner">
    <div style="display:flex; align-items:center; gap:10px; margin-bottom:6px;">
      <div style="width:34px;height:34px;border-radius:10px;background: var(--accent); box-shadow: var(--shadow)"></div>
      <div style="font-weight:900">êµì‚¬ìš© í—ˆë¸Œ</div>
    </div>
    <nav id="navSide" style="display:grid; gap:6px;">
      <button class="navlink active" data-target="dash">ğŸ  ëŒ€ì‹œë³´ë“œ</button>
      <button class="navlink" data-target="calendar">ğŸ“… ì¼ì •</button>
      <button class="navlink" data-target="tasks">ğŸ—‚ï¸ ì—…ë¬´</button>
      <button class="navlink" data-target="files">ğŸ“ ìë£Œì‹¤</button>
      <button class="navlink" data-target="progress">ğŸ“ˆ ì§„ë„</button>
      <button class="navlink" data-target="plans">ğŸ“ ê³„íš</button>
      <button class="navlink" data-target="assess">âœ… í‰ê°€Â·ë³´ì¶©</button>
      <button class="navlink" data-target="minachv">ğŸŒ± ë³´ì¥ì§€ë„</button>
      <button class="navlink" data-target="settings">âš™ï¸ ì„¤ì •</button>
    </nav>
  </div>
</header>

<!-- Arcade bottom dock -->
<div id="dock" class="dock" style="display:none">
  <button class="navlink active" data-target="dash">ëŒ€ì‹œë³´ë“œ</button>
  <button class="navlink" data-target="calendar">ì¼ì •</button>
  <button class="navlink" data-target="tasks">ì—…ë¬´</button>
  <button class="navlink" data-target="files">ìë£Œì‹¤</button>
  <button class="navlink" data-target="progress">ì§„ë„</button>
  <button class="navlink" data-target="plans">ê³„íš</button>
  <button class="navlink" data-target="assess">í‰ê°€</button>
  <button class="navlink" data-target="minachv">ë³´ì¥ì§€ë„</button>
  <button class="navlink" data-target="settings">ì„¤ì •</button>
</div>

<main>
  <!-- Dashboard -->
  <section id="dash" class="active">
    <div class="grid">
      <div class="card" style="grid-column: span 7;">
        <h3>ì´ë²ˆ ì£¼ ìˆ˜ì—…Â·í‰ê°€Â·ë³´ì¶©Â·í–‰ì‚¬</h3>
        <div id="dashWeek"></div>
      </div>
      <div class="card" style="grid-column: span 5;">
        <h3>ì„ë°• ì—…ë¬´</h3>
        <div id="dashDue"></div>
      </div>
      <div class="card" style="grid-column: span 12;">
        <h3>ìš”ì•½ ì§€í‘œ</h3>
        <div class="grid">
          <div class="chart" style="grid-column: span 6;"><canvas id="chTask"></canvas></div>
          <div class="chart" style="grid-column: span 6;"><canvas id="chGap"></canvas></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Calendar -->
  <section id="calendar">
    <div class="grid">
      <div class="card" style="grid-column: span 8;">
        <div class="calendar">
          <div class="calendar-header">
            <div style="display:flex; gap:6px; align-items:center;">
              <button class="btn" id="prevM">â—€</button>
              <div id="monthLabel" style="font-weight:900"></div>
              <button class="btn" id="nextM">â–¶</button>
            </div>
            <div style="display:flex; gap:6px; align-items:center;">
              <select id="calFilter">
                <option value="ALL">í‘œì‹œ: ì „ì²´</option>
                <option>ìˆ˜ì—…</option><option>í‰ê°€</option><option>ë³´ì¶©</option><option>í–‰ì‚¬</option><option>ì—…ë¬´</option>
              </select>
            </div>
          </div>
          <div class="calendar-grid" id="calGrid"></div>
        </div>
      </div>
      <div class="card" style="grid-column: span 4;">
        <h3>í•™êµ í–‰ì‚¬</h3>
        <div style="display:grid; gap:8px;">
          <div><label>í–‰ì‚¬ëª…</label><input class="input" id="evTitle" placeholder="ìˆ˜í•™ì—¬í–‰, ì²´í—˜í•™ìŠµ ë“±"/></div>
          <div><label>ë‚ ì§œ</label><input class="input" id="evDate" type="date"/></div>
          <div><label>ì„¤ëª…</label><textarea class="input" id="evMemo" rows="2"></textarea></div>
          <details>
            <summary class="small">ë°˜ë³„ íŠ¹í™” ë©”ëª¨</summary>
            <div style="display:grid; gap:6px; margin-top:6px;">
              <div><input class="input" id="evClass" placeholder="ì˜ˆ: 1-1"/></div>
              <div><input class="input" id="evClassMemo" placeholder="ì˜ˆ: ì„œìš¸ ì½”ìŠ¤ 10ì‹œ ì¶œë°œ"/></div>
              <button class="btn" id="addClassMemo">ì¶”ê°€</button>
              <div class="small" id="evClassMemoList"></div>
            </div>
          </details>
          <div style="display:flex; gap:8px;">
            <button class="btn btn-primary" id="addEvent">ë“±ë¡</button>
            <button class="btn" id="clearEvent">ì´ˆê¸°í™”</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tasks -->
  <section id="tasks">
    <div class="grid">
      <div class="card" style="grid-column: span 8;">
        <div class="kanban">
          <div class="column" data-col="todo">
            <div style="display:flex; justify-content:space-between; align-items:center;"><strong>í•  ì¼</strong><span class="small" id="cntTodo"></span></div>
            <div class="col-body" id="col-todo"></div>
          </div>
          <div class="column" data-col="doing">
            <div style="display:flex; justify-content:space-between; align-items:center;"><strong>ì§„í–‰</strong><span class="small" id="cntDoing"></span></div>
            <div class="col-body" id="col-doing"></div>
          </div>
          <div class="column" data-col="done">
            <div style="display:flex; justify-content:space-between; align-items:center;"><strong>ì™„ë£Œ</strong><span class="small" id="cntDone"></span></div>
            <div class="col-body" id="col-done"></div>
          </div>
        </div>
      </div>
      <div class="card" style="grid-column: span 4;">
        <h3>ì—…ë¬´ ì¶”ê°€</h3>
        <div style="display:grid; gap:8px;">
          <div><label>ì—…ë¬´ëª…</label><input class="input" id="taskTitle" placeholder="ê°€ì •í†µì‹ ë¬¸ ë°°í¬"/></div>
          <div style="display:flex; gap:8px;">
            <div style="flex:1"><label>ì—­í• </label><select id="taskRole" class="input"><option>ë‹´ì„</option><option>ë¶€ì¥</option><option>êµê³¼</option><option>í–‰ì •</option></select></div>
            <div style="flex:1"><label>ë§ˆê°</label><input class="input" id="taskDue" type="date"/></div>
          </div>
          <div><label>ì§„í–‰ë¥ </label><input id="taskProg" type="range" min="0" max="100" value="0" oninput="byId('progVal').innerText=this.value+'%'"/><div class="small">í˜„ì¬: <span id="progVal">0%</span></div></div>
          <div><label>ë©”ëª¨</label><textarea id="taskMemo" rows="3" class="input"></textarea></div>
          <div style="display:flex; gap:8px;">
            <button id="addTask" class="btn btn-primary" style="flex:1">ì¶”ê°€</button>
            <button id="clearTask" class="btn" style="flex:1">ì´ˆê¸°í™”</button>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
            <button class="btn" id="notifySoon">D-3 ì•Œë¦¼ í…ŒìŠ¤íŠ¸</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Files -->
  <section id="files">
    <div class="grid">
      <div class="card" style="grid-column: span 7;">
        <h3>ì—…ë¡œë“œ</h3>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap: wrap;">
          <input type="file" id="fileInput" multiple />
          <button class="btn" id="uploadFile">ì—…ë¡œë“œ</button>
          <input class="input" id="fileSearch" placeholder="ê²€ìƒ‰(íŒŒì¼ëª…/ëŒ“ê¸€)" style="max-width: 220px;" />
          <select id="fileType" class="input" style="max-width: 160px;">
            <option value="ALL">ìœ í˜•: ì „ì²´</option>
            <option>ì´ë¯¸ì§€</option><option>ë¬¸ì„œ</option><option>ì˜ìƒ</option><option>ì˜¤ë””ì˜¤</option><option>ê¸°íƒ€</option>
          </select>
          <select id="fileSort" class="input" style="max-width: 160px;">
            <option value="recent">ì •ë ¬: ìµœì‹  ì—…ë¡œë“œ</option>
            <option value="name">ì´ë¦„</option>
            <option value="type">ìœ í˜•</option>
            <option value="size">ìš©ëŸ‰</option>
            <option value="opened">ìµœê·¼ ì—´ëŒ</option>
            <option value="comments">ëŒ“ê¸€ ìˆ˜</option>
          </select>
          <button class="btn" id="toggleView">ë³´ê¸°: ë¦¬ìŠ¤íŠ¸</button>
        </div>
        <div id="fileList" style="margin-top: 12px;"></div>
      </div>
      <div class="card" style="grid-column: span 5;">
        <h3>ë¯¸ë¦¬ë³´ê¸°</h3>
        <div id="filePreview" class="preview">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</div>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button class="btn" id="downloadFile">ë‹¤ìš´ë¡œë“œ</button>
          <button class="btn" id="pinFile">í•€ ê³ ì •/í•´ì œ</button>
          <button class="btn" id="delFile">ì‚­ì œ</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Progress -->
  <section id="progress">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <select id="pYear" class="input" style="max-width:120px;"></select>
          <select id="pTerm" class="input" style="max-width:120px;"><option value="1">1í•™ê¸°</option><option value="2">2í•™ê¸°</option></select>
          <input class="input" id="pSubject" placeholder="ê³¼ëª© (ì˜ˆ: êµ­ì–´)" style="max-width:160px;" />
          <input class="input" id="pClass" placeholder="ë°˜ (ì˜ˆ: 1-1)" style="max-width:120px;" />
          <button class="btn" id="pFilter">ì¡°íšŒ</button>
          <button class="btn" id="pAdd">í–‰ ì¶”ê°€</button>
          <button class="btn" id="pCopy">ë‹¤ë¥¸ ë°˜ìœ¼ë¡œ ë³µì‚¬</button>
          <button class="btn" id="pExport">CSV ë‚´ë³´ë‚´ê¸°</button>
          <label class="btn" for="pImport">CSV ê°€ì ¸ì˜¤ê¸°</label>
          <input id="pImport" type="file" accept=".csv" style="display:none" />
        </div>
        <!-- Progress -->
<table class="table responsive" id="pTable" style="margin-top:10px">
          <thead><tr>
            <th>ì£¼ì°¨</th><th>ë‚ ì§œ</th><th>ì°¨ì‹œ</th><th>ë‹¨ì›/ë²”ìœ„</th><th>ëª©í‘œ</th><th>í™œë™/ìë£Œ</th><th>ê³¼ì œ</th><th>ë©”ëª¨</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card" style="grid-column: span 12;">
        <h3>ì£¼ê°„ ë°˜ë³„ ê²©ì°¨</h3>
        <div class="chart"><canvas id="chWeeklyGap"></canvas></div>
      </div>
    </div>
  </section>

  <!-- Plans -->
  <section id="plans">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <select id="plYear" class="input" style="max-width:120px;"></select>
          <select id="plTerm" class="input" style="max-width:120px;"><option value="1">1í•™ê¸°</option><option value="2">2í•™ê¸°</option></select>
          <input class="input" id="plSubject" placeholder="ê³¼ëª©" style="max-width:160px;" />
          <input class="input" id="plClass" placeholder="ë°˜" style="max-width:120px;" />
          <button class="btn" id="plAdd">ì°¨ì‹œ ì¶”ê°€</button>
          <button class="btn" id="plAuto">ì£¼ì°¨â†’ì°¨ì‹œ ìë™ ë°°ë¶„</button>
          <button class="btn" id="plCopy">ë‹¤ë¥¸ ë°˜ìœ¼ë¡œ ë³µì‚¬</button>
          <button class="btn" id="plExport">CSV ë‚´ë³´ë‚´ê¸°</button>
          <label class="btn" for="plImport">CSV ê°€ì ¸ì˜¤ê¸°</label>
          <input id="plImport" type="file" accept=".csv" style="display:none" />
        </div>
        <!-- Plans -->
<table class="table responsive" id="plTable" style="margin-top:10px">
          <thead><tr>
            <th>ì°¨ì‹œ</th><th>ì£¼ì°¨</th><th>ë‚ ì§œ</th><th>ëª©í‘œ</th><th>í•µì‹¬ê°œë…</th><th>ì¤€ë¹„ë¬¼</th><th>ìë£Œë§í¬</th><th>í‰ê°€ë°©ë²•</th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Assessments -->
  <section id="assess">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <input class="input" id="asSubject" placeholder="ê³¼ëª©" style="max-width:160px;">
          <input class="input" id="asClass" placeholder="ë°˜" style="max-width:120px;">
          <button class="btn" id="asAdd">í‰ê°€ ì¶”ê°€</button>
          <button class="btn" id="asExport">CSV ë‚´ë³´ë‚´ê¸°</button>
          <label class="btn" for="asImport">CSV ê°€ì ¸ì˜¤ê¸°</label>
          <input id="asImport" type="file" accept=".csv" style="display:none" />
        </div>
        <!-- Assess -->
<table class="table responsive" id="asTable" style="margin-top:10px">
  <thead>
    <tr>
      <th>ì œëª©</th><th>ìœ í˜•</th><th>ë²”ìœ„</th><th>ë‚ ì§œ</th><th>ë°˜</th><th>ê³¼ëª©</th><th>ë¯¸ì‘ì‹œ</th><th>ë³´ì¶©(ì¼/ì‹œ/ì¥)</th><th>ë©”ëª¨</th><th></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
      </div>
    </div>
  </section>

  <!-- Minimum Achievement -->
  <section id="minachv">
    <div class="grid">
      <div class="card" style="grid-column: span 12;">
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <input class="input" id="maSubject" placeholder="ê³¼ëª©" style="max-width:160px;">
          <input class="input" id="maClass" placeholder="ë°˜" style="max-width:120px;">
          <button class="btn" id="maAdd">ì„¸ì…˜ ì¶”ê°€</button>
          <button class="btn" id="maExport">CSV ë‚´ë³´ë‚´ê¸°</button>
          <label class="btn" for="maImport">CSV ê°€ì ¸ì˜¤ê¸°</label>
          <input id="maImport" type="file" accept=".csv" style="display:none" />
        </div>
        <!-- Minimum Achievement -->
<table class="table responsive" id="maTable" style="margin-top:10px">
          <thead><tr>
            <th>ëª¨ë“œ</th><th>ì œëª©</th><th>ë‚ ì§œ</th><th>ì‹œê°„</th><th>ë°˜</th><th>ê³¼ëª©</th><th>ë‚´ìš©</th><th>ëŒ€ìƒ</th><th>í›„ì†í‰ê°€</th><th>ì°¸ì—¬</th><th>ì¬í‰ê°€</th><th>ê°œì„ </th><th></th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Settings -->
  <section id="settings">
    <div class="grid">
      <div class="card" style="grid-column: span 6;">
        <h3>í…Œë§ˆ</h3>
        <div style="display:grid; gap:8px;">
          <div><label>í¬ì¸íŠ¸ ìƒ‰ìƒ(Hue)</label><input type="range" id="hue" min="0" max="360" value="30" oninput="setHue(this.value)"/></div>
          <div>
            <label>í”„ë¦¬ì…‹(ë ˆì´ì•„ì›ƒ ìœ ì§€, ìƒ‰ìƒë§Œ ë³€ê²½)</label>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn" onclick="setPreset('classic')">Classic(ë„¤ì´ë¹„)</button>
              <button class="btn" onclick="setPreset('arcade')">Arcade(ë¼ì¼ë½)</button>
              <button class="btn" onclick="setPreset('soft')">Soft(ì„¸ì´ì§€)</button>
            </div>
          </div>
          <div>
            <label>ë°ê¸°</label>
            <div style="display:flex; gap:8px;">
              <button class="btn" onclick="toggleDark(false)">ë°ì€ ëª¨ë“œ</button>
              <button class="btn" onclick="toggleDark(true)">ë‹¤í¬ ëª¨ë“œ</button>
            </div>
          </div>
        </div>
      </div>
      <div class="card" style="grid-column: span 6;">
        <h3>ë°±ì—…/ë³µì›</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="exportJSON">JSON ë°±ì—…</button>
          <label class="btn" for="importJSON">JSON ë³µì›</label>
          <input id="importJSON" type="file" accept="application/json" style="display:none">
          <button class="btn" id="resetAll">ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
  </section>
</main>

<div id="toast" style="position: fixed; right: 16px; bottom: 16px; display:flex; flex-direction:column; gap:10px; z-index:100;"></div>

<script>
/* ---------------- State & Utils ---------------- */
const STORE="teacher-mvpplus-v1";
let state=load();
function load(){ try{ const raw=localStorage.getItem(STORE); if(!raw) return defaultState(); const parsed=JSON.parse(raw); return Object.assign(defaultState(), parsed);}catch{return defaultState()} }
function save(){ localStorage.setItem(STORE, JSON.stringify(state)) }
function defaultState(){
  const today=new Date().toISOString().slice(0,10);
  return {
    settings:{ preset:"classic", dark:false, hue:30 },
    events:[{id:rid(), title:"ê°œí•™ì‹", date:today, memo:"ê°•ë‹¹", classMemos:{}, createdAt:now() }],
    tasks:[{id:rid(), title:"ê°€ì •í†µì‹ ë¬¸ ë°°í¬", role:"ë‹´ì„", due:addDays(3), progress:10, memo:"1í•™ë…„ ì „ë°˜", status:"todo", createdAt:now()}],
    files:[],
    progress:[],
    plans:[],
    assessments:[],
    min_achievement:[]
  }
}
function rid(){
    try{
      if (window.crypto && typeof window.crypto.randomUUID === 'function') {
        return window.crypto.randomUUID();
      }
    }catch(e){}
    // êµ¬í˜• ë¸Œë¼ìš°ì €ìš© í´ë°±
    const s = () => Math.random().toString(36).slice(2,10);
    return `id-${Date.now().toString(36)}-${s()}${s()}`;
  }
function now(){ return new Date().toISOString() }
function addDays(n){ const d=new Date(); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10) }
function byId(id){ return document.getElementById(id) }
function fmtDate(s){ if(!s) return ""; const d=new Date(s); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}` }
function dday(due){ if(!due) return ""; const d=new Date(due); const t=new Date(); t.setHours(0,0,0,0); const diff=Math.ceil((d-t)/86400000); if(diff>0) return `D-${diff}`; if(diff===0) return "D-day"; return `D+${Math.abs(diff)}` }
function toast(msg, sub=""){ const wrap=byId("toast"); const el=document.createElement("div"); el.className="card"; el.innerHTML=`<strong>${msg}</strong><div class="small">${sub}</div>`; wrap.appendChild(el); setTimeout(()=>el.remove(),4500) }

/* ---------------- Theme & Layout ---------------- */
function applyHue(hue){
  const h = Number(hue);
  document.documentElement.style.setProperty('--hue', h);
  document.documentElement.style.setProperty('--accent', `hsl(${h}, 45%, 48%)`);
  document.documentElement.style.setProperty('--accent-strong', `hsl(${h}, 55%, 42%)`);
}
function setHue(v){
  state.settings.hue = Number(v);
  applyHue(state.settings.hue);
  save();
}
function toggleDark(d){ document.body.setAttribute('data-theme', d?'dark':'light'); state.settings.dark=!!d; save() }
function setPreset(p){
  state.settings.preset = p; 
  save();

  // ë ˆì´ì•„ì›ƒ í´ë˜ìŠ¤ ìŠ¤ìœ„ì¹­
  document.body.classList.remove("theme-classic","theme-arcade","theme-soft");
  if(p==="classic") document.body.classList.add("theme-classic");
  if(p==="arcade")  document.body.classList.add("theme-arcade");
  if(p==="soft")    document.body.classList.add("theme-soft");

  // ë ˆì´ì•„ì›ƒ ì˜ì—­ í‘œì‹œ ì „í™˜
  byId("headerTop").style.display  = p==="classic" ? "block" : "none";
  byId("headerSide").style.display = p==="soft"    ? "block" : "none";
  byId("dock").style.display       = p==="arcade"  ? "flex"  : "none";

  // í”„ë¦¬ì…‹ë³„ Hue ì§€ì • + ì¦‰ì‹œ ì ìš©
  const hue = p==="classic" ? 212 : p==="arcade" ? 265 : 170;
  state.settings.hue = hue;
  applyHue(hue);
  save();
}
/* nav binding */
function bindNav(container){
  if(!container) return;
  Array.from(container.querySelectorAll("[data-target]")).forEach(btn=>{
    btn.addEventListener("click", ()=>{
      document.querySelectorAll("main section").forEach(s=> s.classList.remove("active"));
      document.querySelectorAll("[data-target]").forEach(b=> b.classList.remove("active"));
      byId(btn.dataset.target).classList.add("active");
      Array.from(document.querySelectorAll("[data-target='"+btn.dataset.target+"']")).forEach(b=> b.classList.add("active"));
      if(btn.dataset.target==="dash") drawDash();
      if(btn.dataset.target==="calendar") renderCalendar();
      if(btn.dataset.target==="tasks") renderKanban();
      if(btn.dataset.target==="files") renderFiles();
      if(btn.dataset.target==="progress") { renderProgress(); drawWeeklyGap(); }
      if(btn.dataset.target==="plans") renderPlans();
      if(btn.dataset.target==="assess") renderAssess();
      if(btn.dataset.target==="minachv") renderMinAchv();
    })
  })
}
bindNav(byId("navTop")); bindNav(byId("navSide")); bindNav(byId("dock"));

/* ---------------- Dashboard ---------------- */
function drawDash(){
  // Week range
  const today=new Date(); const start=new Date(today); start.setDate(today.getDate()-today.getDay()); const end=new Date(start); end.setDate(start.getDate()+6);
  const inWeek = d => { const x=new Date(d); return x>=start && x<=end }
  // Compose list
  const weekEvents = state.events.filter(e=> inWeek(e.date));
  const weekAssess = state.assessments.filter(a=> inWeek(a.date) || (a.makeup && inWeek(a.makeup.date)));
  const weekMin = state.min_achievement.filter(m=> inWeek(m.date));
  const weekTasks = state.tasks.filter(t=> inWeek(t.due));
  byId("dashWeek").innerHTML = [
    ...weekEvents.map(e=>`<div class="file-card"><div><strong>í–‰ì‚¬</strong> ${e.title} <span class="small">(${fmtDate(e.date)})</span></div><div class="small">${Object.keys(e.classMemos||{}).length? 'ë°˜ë³„ ë©”ëª¨ ìˆìŒ':''}</div></div>`),
    ...weekAssess.map(a=>`<div class="file-card"><div><strong>í‰ê°€</strong> ${a.title} ${a.type} <span class="small">(${fmtDate(a.date)})</span></div><div class="small">${a.makeup? 'ë³´ì¶© '+fmtDate(a.makeup.date)+' '+(a.makeup.time||''):''}</div></div>`),
    ...weekMin.map(m=>`<div class="file-card"><div><strong>${m.mode==='prevention'?'ì˜ˆë°©':'ë³´ì¶©'}</strong> ${m.title} <span class="small">(${fmtDate(m.date)} ${m.time||''})</span></div><div class="small">${m.class} ${m.subject||''}</div></div>`),
    ...weekTasks.map(t=>`<div class="file-card"><div><strong>ì—…ë¬´</strong> ${t.title}</div><div class="small">ë§ˆê° ${fmtDate(t.due)}</div></div>`)
  ].join("") || '<div class="small">ì´ë²ˆ ì£¼ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';

  const dueSoon = state.tasks.filter(t=> t.status!=="done" && Math.ceil((new Date(t.due)-new Date())/86400000)<=3).sort((a,b)=> new Date(a.due)-new Date(b.due));
  byId("dashDue").innerHTML = dueSoon.length ? dueSoon.map(t=>`<div class="task"><div style="display:flex; justify-content:space-between;"><strong>${t.title}</strong><span class="small">${fmtDate(t.due)} Â· ${dday(t.due)}</span></div><div class="progress"><span style="width:${t.progress}%"></span></div><div class="small">ì§„í–‰ë¥  ${t.progress}% Â· ${t.role}</div></div>`).join("") : '<div class="small">ì„ë°• ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';

  drawBar(byId("chTask").getContext("2d"), ["í•  ì¼","ì§„í–‰","ì™„ë£Œ"], [
    state.tasks.filter(x=>x.status==="todo").length,
    state.tasks.filter(x=>x.status==="doing").length,
    state.tasks.filter(x=>x.status==="done").length
  ]);

  // gap: compute current week subject/class variance by period count
  const week = getWeekNumber(today);
  const classes = [...new Set(state.progress.filter(p=> p.week==week).map(p=> p.class))];
  const counts = classes.map(c=> state.progress.filter(p=> p.week==week && p.class===c).reduce((s,p)=> s+(Number(p.period)||0),0));
  drawBar(byId("chGap").getContext("2d"), classes.length?classes:["ë°ì´í„° ì—†ìŒ"], counts.length?counts:[0]);
}

/* ---------------- Calendar with filters ---------------- */
let curMonth=new Date(); curMonth.setDate(1);
byId("prevM").onclick=()=>{ curMonth.setMonth(curMonth.getMonth()-1); renderCalendar() }
byId("nextM").onclick=()=>{ curMonth.setMonth(curMonth.getMonth()+1); renderCalendar() }
byId("calFilter").onchange=renderCalendar;

function renderCalendar(){
  byId("monthLabel").textContent = `${curMonth.getFullYear()}ë…„ ${curMonth.getMonth()+1}ì›”`;
  const grid=byId("calGrid"); grid.innerHTML="";
  const names=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "]; for(const n of names){ const d=document.createElement("div"); d.className="day-name"; d.textContent=n; grid.appendChild(d) }
  const firstDay=new Date(curMonth); const startIdx=firstDay.getDay(); const daysInMonth=new Date(curMonth.getFullYear(), curMonth.getMonth()+1,0).getDate();
  for(let i=0;i<startIdx;i++){ const c=document.createElement("div"); c.className="cell"; grid.appendChild(c) }
  const filter=byId("calFilter").value;
  for(let date=1; date<=daysInMonth; date++){
    const iso=`${curMonth.getFullYear()}-${String(curMonth.getMonth()+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
    const cell=document.createElement("div"); cell.className="cell";
    const head=document.createElement("div"); head.className="small"; head.textContent=`${date}`; cell.appendChild(head);
    // events
    const ev = state.events.filter(e=> e.date===iso && (filter==="ALL" || filter==="í–‰ì‚¬"));
    ev.forEach(e=>{
      const el=document.createElement("div"); el.className="event"; el.innerHTML=`<strong>í–‰ì‚¬</strong> ${e.title}`; el.title=e.memo||"";
      el.onclick=()=> openEventMemo(e);
      cell.appendChild(el);
    });
    // assessments
    const as = state.assessments.filter(a=> (a.date===iso || (a.makeup && a.makeup.date===iso)) && (filter==="ALL" || filter==="í‰ê°€" || filter==="ë³´ì¶©"));
    as.forEach(a=>{
      const el=document.createElement("div"); el.className="event"; el.innerHTML=`<strong>${a.date===iso?'í‰ê°€':'ë³´ì¶©'}</strong> ${a.title}`; cell.appendChild(el);
    });
    // tasks
    const ts = state.tasks.filter(t=> t.due===iso && (filter==="ALL" || filter==="ì—…ë¬´"));
    ts.forEach(t=>{ const el=document.createElement("div"); el.className="event"; el.innerHTML=`<strong>ì—…ë¬´</strong> ${t.title}`; cell.appendChild(el) });
    // progress sessions (class lessons)
    const pr = state.progress.filter(p=> p.date===iso && (filter==="ALL" || filter==="ìˆ˜ì—…"));
    pr.forEach(p=>{ const el=document.createElement("div"); el.className="event"; el.innerHTML=`<strong>ìˆ˜ì—…</strong> ${p.subject||''} ${p.class||''} ${p.period||''}ì°¨ì‹œ`; cell.appendChild(el) });
    grid.appendChild(cell);
  }
}
function openEventMemo(e){
  const lines = Object.entries(e.classMemos||{}).map(([cls,m])=> `<div><strong>${cls}</strong> <span class="small">${m}</span></div>`).join("") || '<div class="small">ë°˜ë³„ ë©”ëª¨ ì—†ìŒ</div>';
  alert(`í–‰ì‚¬: ${e.title}\në‚ ì§œ: ${fmtDate(e.date)}\nê³µí†µ ë©”ëª¨: ${e.memo||''}\n\në°˜ë³„ ë©”ëª¨:\n${Object.entries(e.classMemos||{}).map(([k,v])=>`${k}: ${v}`).join("\n")||'-'}`);
}

/* ---------------- Events create ---------------- */
let classMemoTemp={};
byId("addClassMemo").onclick=()=>{
  const cls=byId("evClass").value.trim(), memo=byId("evClassMemo").value.trim();
  if(!cls || !memo) return;
  classMemoTemp[cls]=memo;
  byId("evClassMemoList").innerHTML = Object.entries(classMemoTemp).map(([k,v])=>`<div class="small">${k}: ${v}</div>`).join("");
  byId("evClass").value=""; byId("evClassMemo").value="";
}
byId("addEvent").onclick=()=>{
  const title=byId("evTitle").value.trim(), date=byId("evDate").value;
  if(!title||!date){ toast("ì…ë ¥ ì˜¤ë¥˜","í–‰ì‚¬ëª…/ë‚ ì§œ í•„ìˆ˜"); return }
  const memo=byId("evMemo").value.trim();
  state.events.push({ id:rid(), title, date, memo, classMemos: {...classMemoTemp}, createdAt: now() });
  classMemoTemp={}; byId("evClassMemoList").innerHTML="";
  save(); renderCalendar(); drawDash(); toast("í–‰ì‚¬ ë“±ë¡", `${title} Â· ${fmtDate(date)}`);
  ["evTitle","evDate","evMemo"].forEach(id=> byId(id).value="");
}
byId("clearEvent").onclick=()=>{ ["evTitle","evDate","evMemo"].forEach(id=> byId(id).value=""); classMemoTemp={}; byId("evClassMemoList").innerHTML=""; }

/* ---------------- Tasks (Kanban + alerts) ---------------- */
function renderKanban(){
  const cols={ todo:byId("col-todo"), doing:byId("col-doing"), done:byId("col-done") };
  Object.values(cols).forEach(c=> c.innerHTML="");
  const tasks=state.tasks.slice().sort((a,b)=> new Date(a.due)-new Date(b.due));
  let cTodo=0,cDoing=0,cDone=0;
  for(const t of tasks){
    const card=document.createElement("div"); card.className="task"; card.draggable=true;
    card.innerHTML=`<div style="display:flex; justify-content:space-between; gap:8px;"><div><strong>${t.title}</strong></div><div class="small">${fmtDate(t.due)} Â· ${dday(t.due)}</div></div><div class="small">${t.memo||""}</div><div class="progress"><span style="width:${t.progress}%"></span></div><div class="small">ì§„í–‰ë¥  ${t.progress}% Â· ${t.role}</div><div style="display:flex; gap:6px; margin-top:6px;"><button class="btn" data-act="edit">í¸ì§‘</button><button class="btn" data-act="del">ì‚­ì œ</button></div>`;
    card.querySelector('[data-act="del"]').onclick=()=>{ if(confirm("ì‚­ì œí• ê¹Œìš”?")){ state.tasks = state.tasks.filter(x=>x.id!==t.id); save(); renderKanban(); drawDash() } };
    card.querySelector('[data-act="edit"]').onclick=()=>{ const np=prompt("ìƒˆ ì§„í–‰ë¥ (0-100)", t.progress); if(np===null) return; const v=Math.max(0,Math.min(100,Number(np)||0)); t.progress=v; t.status = v>=100 ? "done" : v>0 ? "doing" : "todo"; save(); renderKanban(); drawDash(); };
    card.addEventListener("dragstart", e=> e.dataTransfer.setData("text/plain", t.id));
    cols[t.status].appendChild(card);
    if(t.status==="todo") cTodo++; else if(t.status==="doing") cDoing++; else cDone++;
  }
  byId("cntTodo").textContent=`${cTodo}ê±´`; byId("cntDoing").textContent=`${cDoing}ê±´`; byId("cntDone").textContent=`${cDone}ê±´`;
  document.querySelectorAll(".column").forEach(col=>{ col.ondragover=e=>e.preventDefault(); col.ondrop=e=>{ e.preventDefault(); const id=e.dataTransfer.getData("text/plain"); const t=state.tasks.find(x=>x.id===id); t.status=col.dataset.col; if(t.status==="done") t.progress=100; else if(t.status==="doing"&&t.progress===0) t.progress=10; save(); renderKanban(); drawDash(); }; });
}
byId("addTask").onclick=()=>{
  const title=byId("taskTitle").value.trim(), role=byId("taskRole").value, due=byId("taskDue").value, progress=Number(byId("taskProg").value)||0, memo=byId("taskMemo").value.trim();
  if(!title||!due){ toast("ì…ë ¥ ì˜¤ë¥˜","ì—…ë¬´ëª…/ë§ˆê°ì¼"); return }
  const status=progress>=100?"done":progress>0?"doing":"todo";
  state.tasks.push({ id:rid(), title, role, due, progress, memo, status, createdAt: now() });
  save(); renderKanban(); drawDash(); ["taskTitle","taskDue","taskMemo"].forEach(id=> byId(id).value=""); byId("taskProg").value=0; byId("progVal").innerText="0%";
}
byId("clearTask").onclick=()=>{ ["taskTitle","taskDue","taskMemo"].forEach(id=> byId(id).value=""); byId("taskProg").value=0; byId("progVal").innerText="0%" }
byId("notifySoon").onclick=()=>{ const soon=state.tasks.filter(t=> Math.ceil((new Date(t.due)-new Date())/86400000)<=3 && t.status!=="done"); if(!soon.length) toast("ì•Œë¦¼","3ì¼ ë‚´ ë§ˆê° ì—†ìŒ"); else soon.forEach(t=> toast("ì„ë°• ì—…ë¬´", `${t.title} Â· ${fmtDate(t.due)} (${dday(t.due)})`)) }

/* ---------------- Files with quick preview ---------------- */
let fileView="list"; let selectedFileId=null;
function typeOfFile(name){
  const ext=(name.split(".").pop()||"").toLowerCase();
  if(["jpg","jpeg","png","gif","svg","webp"].includes(ext)) return "ì´ë¯¸ì§€";
  if(["pdf","txt","md","csv"].includes(ext)) return "ë¬¸ì„œ";
  if(["mp4","webm","mov","m4v"].includes(ext)) return "ì˜ìƒ";
  if(["mp3","wav","ogg","m4a"].includes(ext)) return "ì˜¤ë””ì˜¤";
  return "ê¸°íƒ€";
}
byId("toggleView").onclick=()=>{ fileView = fileView==="list"?"grid":"list"; renderFiles() }
byId("uploadFile").onclick=()=>{
  const input=byId("fileInput"); if(!input.files?.length){ toast("ì—…ë¡œë“œ ì‹¤íŒ¨","íŒŒì¼ ì„ íƒ"); return }
  Array.from(input.files).forEach(f=>{
    const id=rid(); const reader=new FileReader();
    reader.onload=()=>{
      state.files.push({ id, name:f.name, size:f.size, type:typeOfFile(f.name), data:reader.result, createdAt: now(), lastOpen: null, pin:false, comments:[], link:null });
      save(); renderFiles(); input.value=""; toast("ì—…ë¡œë“œ", `${f.name} (${f.size}B)`);
    };
    reader.readAsDataURL(f);
  });
}
byId("downloadFile").onclick=()=>{
  const f=state.files.find(x=>x.id===selectedFileId); if(!f){ toast("ì„ íƒ ì—†ìŒ"); return }
  const a=document.createElement("a"); a.href=f.data; a.download=f.name; a.click();
}
byId("pinFile").onclick=()=>{ const f=state.files.find(x=>x.id===selectedFileId); if(!f) return; f.pin=!f.pin; save(); renderFiles() }
byId("delFile").onclick=()=>{ if(!selectedFileId) return; if(confirm("ì‚­ì œí• ê¹Œìš”?")){ state.files = state.files.filter(x=>x.id!==selectedFileId); save(); renderFiles(); byId("filePreview").innerHTML="íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”."; selectedFileId=null } }

byId("fileSearch").oninput=renderFiles; byId("fileType").onchange=renderFiles; byId("fileSort").onchange=renderFiles;
function renderFiles(){
  const wrap=byId("fileList"); const q=byId("fileSearch").value.trim().toLowerCase(); const ft=byId("fileType").value;
  const sort=byId("fileSort").value;
  let files=state.files.slice();
  // filter
  files=files.filter(f=> (ft==="ALL"||f.type===ft) && (f.name.toLowerCase().includes(q) || (f.comments||[]).some(c=> c.toLowerCase().includes(q))));
  // sort
  files.sort((a,b)=>{
    if(a.pin!==b.pin) return a.pin?-1:1;
    if(sort==="recent") return new Date(b.createdAt)-new Date(a.createdAt);
    if(sort==="name") return a.name.localeCompare(b.name, "ko");
    if(sort==="type") return a.type.localeCompare(b.type, "ko");
    if(sort==="size") return (b.size||0)-(a.size||0);
    if(sort==="opened") return (new Date(b.lastOpen||0)) - (new Date(a.lastOpen||0));
    if(sort==="comments") return (b.comments?.length||0) - (a.comments?.length||0);
    return 0;
  });
  // view
  wrap.innerHTML="";
  if(!files.length){ wrap.innerHTML='<div class="small">íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return }
  const list=document.createElement("div");
  list.style.display="grid"; list.style.gap="8px";
  list.style.gridTemplateColumns = fileView==="grid" ? "repeat(auto-fill, minmax(220px,1fr))" : "1fr";
  files.forEach(f=>{
    const row=document.createElement("div"); row.className="file-card"; row.tabIndex=0;
    row.innerHTML=`<div style="flex:1 1 auto;">
      <div><strong>${f.name}</strong> ${f.pin?'<span class="pin">â˜…</span>':''}</div>
      <div class="file-meta">${f.type} Â· ${(f.size||0)}B Â· ì—…ë¡œë“œ ${fmtDate(f.createdAt)}</div>
      <div id="cmt-${f.id}">${(f.comments||[]).slice(-2).map(c=>`<div class="small">â€¢ ${c}</div>`).join("")}</div>
      <div style="display:flex; gap:6px; margin-top:6px;">
        <input class="input" id="inp-${f.id}" placeholder="ëŒ“ê¸€ ì¶”ê°€..." />
        <button class="btn" data-add="${f.id}">ì¶”ê°€</button>
      </div>
    </div>
    <div><button class="btn" data-open="${f.id}">ì—´ê¸°</button></div>`;
    row.querySelector(`[data-add="${f.id}"]`).onclick=()=>{ const val=byId(`inp-${f.id}`).value.trim(); if(!val) return; f.comments=f.comments||[]; f.comments.push(val); save(); byId(`cmt-${f.id}`).insertAdjacentHTML("beforeend", `<div class="small">â€¢ ${val}</div>`); byId(`inp-${f.id}`).value=""; };
    row.querySelector(`[data-open="${f.id}"]`).onclick=()=> openFile(f.id);
    row.addEventListener("keydown", e=>{ if(e.key==="Enter") openFile(f.id) });
    list.appendChild(row);
  });
  wrap.appendChild(list);
}
function openFile(id){
  selectedFileId=id; const f=state.files.find(x=>x.id===id); if(!f) return;
  f.lastOpen=now(); save();
  const prev=byId("filePreview");
  if(f.type==="ì´ë¯¸ì§€"){ prev.innerHTML=`<img src="${f.data}" alt="${f.name}" style="max-width:100%; height:auto; border-radius:12px;" />`; }
  else if(f.type==="ë¬¸ì„œ"){
    if(f.name.toLowerCase().endsWith(".pdf")) prev.innerHTML=`<embed src="${f.data}" type="application/pdf" style="width:100%; height:300px; border:0; border-radius:8px;">`;
    else {
      fetch(f.data).then(r=>r.text()).then(t=>{
        const lines = t.split(/\r?\n/).slice(0,20).join("\n").replace(/[&<>]/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[s]));
        prev.innerHTML=`<pre style="white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;">${lines}</pre>`;
      }).catch(()=> prev.textContent="ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  }
  else if(f.type==="ì˜ìƒ"){ prev.innerHTML=`<video controls src="${f.data}" style="max-width:100%; border-radius:8px;"></video>`; }
  else if(f.type==="ì˜¤ë””ì˜¤"){ prev.innerHTML=`<audio controls src="${f.data}" style="width:100%"></audio>`; }
  else { prev.innerHTML=`<div class="small">ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ìœ í˜•ì…ë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œë¡œ ì—´ì–´ì£¼ì„¸ìš”.</div>`; }
}

/* ---------------- Progress (week/date/period) ---------------- */
function yearOptions(sel){ sel.innerHTML=""; const y=new Date().getFullYear(); for(let i=-1;i<=1;i++){ const opt=document.createElement("option"); opt.value=y+i; opt.textContent=y+i; sel.appendChild(opt) } sel.value=y }
yearOptions(byId("pYear")); yearOptions(byId("plYear"));
function getWeekNumber(d){ d=new Date(d); d.setHours(0,0,0,0); const jan1=new Date(d.getFullYear(),0,1); const days=Math.floor((d-jan1)/86400000)+jan1.getDay()+1; return Math.ceil(days/7) }
byId("pFilter").onclick=renderProgress;
byId("pAdd").onclick=()=> addProgressRow({year:Number(byId("pYear").value), term:Number(byId("pTerm").value), subject:byId("pSubject").value.trim(), class:byId("pClass").value.trim(), week:getWeekNumber(new Date()), date:new Date().toISOString().slice(0,10), period:1, unit:"", goal:"", activities:"", homework:"", note:""});
byId("pCopy").onclick=()=>{
  const src = state.progress.filter(p=> p.year==byId("pYear").value && p.term==byId("pTerm").value && p.subject==byId("pSubject").value.trim() && p.class==byId("pClass").value.trim());
  const to = prompt("ë³µì‚¬ ëŒ€ìƒ ë°˜(ì‰¼í‘œë¡œ ì—¬ëŸ¬ ê°œ)");
  if(!to) return;
  to.split(",").map(s=>s.trim()).filter(Boolean).forEach(cls=>{
    src.forEach(p=> state.progress.push({...p, id:rid(), class:cls}));
  });
  save(); toast("ë³µì‚¬ ì™„ë£Œ","ì„ íƒ ë°˜ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
byId("pExport").onclick=()=>{
  const rows=[["year","term","subject","class","week","date","period","unit","goal","activities","homework","note"]].concat(state.progress.map(p=>[p.year,p.term,p.subject,p.class,p.week,p.date,p.period,p.unit,p.goal,p.activities,p.homework,p.note]));
  downloadCSV("progress.csv", rows);
}
byId("pImport").onchange=e=> importCSV(e.target.files?.[0], rows=>{
  rows.slice(1).forEach(r=>{
    if(!r.length) return;
    const [year,term,subject,cls,week,date,period,unit,goal,activities,homework,note]=r;
    state.progress.push({ id:rid(), year:Number(year), term:Number(term), subject, class:cls, week:Number(week), date, period:Number(period), unit, goal, activities, homework, note });
  });
  save(); renderProgress(); toast("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ","ì§„ë„í‘œê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
});

function renderProgress(){
  const tbody=byId("pTable").querySelector("tbody"); tbody.innerHTML="";
  const y=Number(byId("pYear").value), t=Number(byId("pTerm").value), s=byId("pSubject").value.trim(), c=byId("pClass").value.trim();
  const rows = state.progress.filter(p=> (!y||p.year==y)&&(!t||p.term==t)&&(!s||p.subject==s)&&(!c||p.class==c)).sort((a,b)=> new Date(a.date)-new Date(b.date) || (a.period-b.period));
  rows.forEach(p=> addProgressRow(p, true));
}
function addProgressRow(p, append=false){
  if(!p.id){ p.id=rid(); state.progress.push(p); save() }
  const tr=document.createElement("tr"); tr.innerHTML=`
    <td><input class="input" value="${p.week||''}" style="max-width:70px"></td>
    <td><input class="input" type="date" value="${p.date||''}" style="max-width:150px"></td>
    <td><input class="input" value="${p.period||''}" style="max-width:70px"></td>
    <td><input class="input" value="${p.unit||''}"></td>
    <td><input class="input" value="${p.goal||''}"></td>
    <td><input class="input" value="${p.activities||''}"></td>
    <td><input class="input" value="${p.homework||''}"></td>
    <td><input class="input" value="${p.note||''}"></td>
    <td><button class="btn">ì‚­ì œ</button></td>`;
  const [w,d,pr,unit,goal,act,hw,note,del]=tr.querySelectorAll("td > *");
  const sync=()=>{ p.week=Number(w.value)||0; p.date=d.value; p.period=Number(pr.value)||0; p.unit=unit.value; p.goal=goal.value; p.activities=act.value; p.homework=hw.value; p.note=note.value; save(); drawWeeklyGap(); renderCalendar(); drawDash(); };
  [w,d,pr,unit,goal,act,hw,note].forEach(el=> el.addEventListener("change", sync));
  del.onclick=()=>{ if(confirm("ì‚­ì œí• ê¹Œìš”?")){ state.progress = state.progress.filter(x=>x.id!==p.id); save(); renderProgress(); drawWeeklyGap(); renderCalendar(); drawDash(); } };
  byId("pTable").querySelector("tbody").appendChild(tr);
}

/* weekly gap chart */
function drawWeeklyGap(){
  const ctx=byId("chWeeklyGap").getContext("2d");
  const week = getWeekNumber(new Date());
  const classes=[...new Set(state.progress.filter(p=> p.week==week).map(p=> p.class))];
  const counts=classes.map(c=> state.progress.filter(p=> p.week==week && p.class===c).reduce((s,p)=> s+(Number(p.period)||0),0));
  drawBar(ctx, classes.length?classes:["ë°ì´í„° ì—†ìŒ"], counts.length?counts:[0]);
}

/* ---------------- Plans ---------------- */
byId("plAdd").onclick=()=> addPlanRow({year:Number(byId("plYear").value), term:Number(byId("plTerm").value), subject:byId("plSubject").value.trim(), class:byId("plClass").value.trim(), period:1, week:getWeekNumber(new Date()), date:new Date().toISOString().slice(0,10), goal:"", keyConcept:"", materials:"", assessment:""});
byId("plAuto").onclick=()=>{
  const startW=Number(prompt("ì‹œì‘ ì£¼ì°¨", getWeekNumber(new Date()))||0);
  const count=Number(prompt("ìƒì„±í•  ì°¨ì‹œ ìˆ˜", 4)||0);
  for(let i=0;i<count;i++){
    addPlanRow({year:Number(byId("plYear").value), term:Number(byId("plTerm").value), subject:byId("plSubject").value.trim(), class:byId("plClass").value.trim(), period:i+1, week:startW, date:"", goal:"", keyConcept:"", materials:"", assessment:""});
  }
  toast("ìë™ ë°°ë¶„","ì°¨ì‹œ ë¼ˆëŒ€ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
byId("plCopy").onclick=()=>{
  const src = state.plans.filter(p=> p.year==byId("plYear").value && p.term==byId("plTerm").value && p.subject==byId("plSubject").value.trim() && p.class==byId("plClass").value.trim());
  const to = prompt("ë³µì‚¬ ëŒ€ìƒ ë°˜(ì‰¼í‘œë¡œ ì—¬ëŸ¬ ê°œ)");
  if(!to) return;
  to.split(",").map(s=>s.trim()).filter(Boolean).forEach(cls=>{
    src.forEach(p=> state.plans.push({...p, id:rid(), class:cls}));
  });
  save(); toast("ë³µì‚¬ ì™„ë£Œ","ê³„íšì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
byId("plExport").onclick=()=>{
  const rows=[["year","term","subject","class","period","week","date","goal","keyConcept","materials","assessment"]].concat(state.plans.map(p=>[p.year,p.term,p.subject,p.class,p.period,p.week,p.date,p.goal,p.keyConcept,p.materials,p.assessment]));
  downloadCSV("plans.csv", rows);
}
byId("plImport").onchange=e=> importCSV(e.target.files?.[0], rows=>{
  rows.slice(1).forEach(r=>{
    if(!r.length) return;
    const [year,term,subject,cls,period,week,date,goal,keyConcept,materials,assessment]=r;
    state.plans.push({ id:rid(), year:Number(year), term:Number(term), subject, class:cls, period:Number(period), week:Number(week), date, goal, keyConcept, materials, assessment });
  });
  save(); renderPlans(); toast("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ","ê³„íšì´ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
});
function renderPlans(){
  const tbody=byId("plTable").querySelector("tbody"); tbody.innerHTML="";
  const y=Number(byId("plYear").value), t=Number(byId("plTerm").value), s=byId("plSubject").value.trim(), c=byId("plClass").value.trim();
  const rows = state.plans.filter(p=> (!y||p.year==y)&&(!t||p.term==t)&&(!s||p.subject==s)&&(!c||p.class==c)).sort((a,b)=> (a.period-b.period) || new Date(a.date)-new Date(b.date));
  rows.forEach(p=> addPlanRow(p, true));
}
function addPlanRow(p, append=false){
  if(!p.id){ p.id=rid(); state.plans.push(p); save() }
  const tr=document.createElement("tr"); tr.innerHTML=`
    <td><input class="input" value="${p.period||''}" style="max-width:70px"></td>
    <td><input class="input" value="${p.week||''}" style="max-width:70px"></td>
    <td><input class="input" type="date" value="${p.date||''}" style="max-width:150px"></td>
    <td><input class="input" value="${p.goal||''}"></td>
    <td><input class="input" value="${p.keyConcept||''}"></td>
    <td><input class="input" value="${p.materials||''}"></td>
    <td><input class="input" value="${p.assessment||''}"></td>
    <td><button class="btn">ì‚­ì œ</button></td>`;
  const [period,week,date,goal,key,mat,ass,del]=tr.querySelectorAll("td > *");
  const sync=()=>{ p.period=Number(period.value)||0; p.week=Number(week.value)||0; p.date=date.value; p.goal=goal.value; p.keyConcept=key.value; p.materials=mat.value; p.assessment=ass.value; save(); };
  [period,week,date,goal,key,mat,ass].forEach(el=> el.addEventListener("change", sync));
  del.onclick=()=>{ if(confirm("ì‚­ì œí• ê¹Œìš”?")){ state.plans = state.plans.filter(x=>x.id!==p.id); save(); renderPlans(); } };
  byId("plTable").querySelector("tbody").appendChild(tr);
}

/* ---------------- Assessments (with absentees & makeup) ---------------- */
byId("asAdd").onclick=()=> addAssessRow({title:"ë‹¨ì›í‰ê°€", type:"ë‹¨ì›", scope:"", date:new Date().toISOString().slice(0,10), class:byId("asClass").value.trim(), subject:byId("asSubject").value.trim(), absentees:"", makeup:{date:"", time:"", place:""}, note:""});
byId("asExport").onclick=()=>{
  const rows=[["subject","class","type","title","scope","date","absentees","makeup_date","makeup_time","makeup_place","note"]].concat(state.assessments.map(a=>[a.subject||"",a.class||"",a.type||"",a.title||"",a.scope||"",a.date||"",a.absentees||"",a.makeup?.date||"",a.makeup?.time||"",a.makeup?.place||"",a.note||""]));
  downloadCSV("assessments.csv", rows);
}
byId("asImport").onchange=e=> importCSV(e.target.files?.[0], rows=>{
  rows.slice(1).forEach(r=>{
    if(!r.length) return;
    const [subject,cls,type,title,scope,date,abs,md,mt,mp,note]=r;
    state.assessments.push({ id:rid(), subject, class:cls, type, title, scope, date, absentees:abs, makeup:{date:md,time:mt,place:mp}, note });
  });
  save(); renderAssess(); toast("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ","í‰ê°€ê°€ ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
});
// í‰ê°€ í…Œì´ë¸”ì„ 'í‰ê°€ ì¹´ë“œ(assessSection)' ë‚´ë¶€ì— ìƒì„±/ì´ë™
function ensureAssTable(){
  // 1) ì•µì»¤(í‰ê°€ ì»¨íŠ¸ë¡¤ì´ ìˆëŠ” ì¹´ë“œ) ì°¾ê¸°
  const anchor =
    document.getElementById("assessSection") ||
    document.getElementById("assess") ||
    document.querySelector('section#assess') ||
    document.querySelector('[data-section="assess"]') ||
    document.body; // ìµœí›„ì˜ ë³´ë£¨

  // 2) ê¸°ì¡´ ë˜í¼/í…Œì´ë¸”ì´ ìˆìœ¼ë©´ ì¹´ë“œ ë‚´ë¶€ë¡œ ì´ë™ë§Œ
  const existed = document.getElementById("assTable-wrapper");
  if (existed){
    if (!anchor.contains(existed)) anchor.appendChild(existed);
    return;
  }

  // 3) ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
  const wrap = document.createElement("div");
  wrap.id = "assTable-wrapper";
  wrap.innerHTML = `
    <table id="assTable" class="table" style="margin-top:10px; width:100%">
      <thead>
        <tr>
          <th>ì œëª©</th>
          <th>ìœ í˜•</th>
          <th>ë²”ìœ„</th>
          <th>ë‚ ì§œ</th>
          <th>ë°˜</th>
          <th>ê³¼ëª©</th>
          <th>ë¯¸ì‘ì‹œ</th>
          <th>ë³´ì¶©(ì¼ì‹œ/ì¥)</th>
          <th>ë©”ëª¨</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  `;
  anchor.appendChild(wrap);
}

// â˜… í‰ê°€ í‘œ ë Œë”: í—¤ë” ì´ì¤‘ ì œê±° + ì‹œê°„/ì¥ì†Œ ì—†ëŠ” ì •ë‹µ êµ¬ì¡°ë¡œ ì¬êµ¬ì„±
function renderAssess(){
  ensureAssTable?.();

  const table = document.getElementById("assTable");
  if (!table) return;

  // â˜… ì„¹ì…˜ ì•ˆì˜ ì¤‘ë³µ í‘œ(í—¤ë”ë§Œ ìˆëŠ” í‘œ/ì˜› í‘œ) ì œê±°
  const host = table.closest('#assessSection, #assess, section#assess') || table.parentElement;
  if (host){
    [...host.querySelectorAll('table.table')].forEach(t=>{
      if (t === table) return;
      const onlyHeader = (t.tBodies.length === 0 && t.tHead && t.tHead.querySelector('th'));
      const bodyHasTh  = [...t.tBodies].some(tb => tb.querySelector('th'));
      if (onlyHeader || bodyHasTh) t.remove(); // â† ì¤‘ë³µ í—¤ë”í‘œ ì œê±°
    });
  }

  // ìš°ë¦¬ê°€ ì“°ëŠ” ì •ë‹µ í—¤ë”ë¡œ ì¬êµ¬ì„±
  table.innerHTML = `
    <thead>
      <tr>
        <th>ì œëª©</th>
        <th>ìœ í˜•</th>
        <th>ë²”ìœ„</th>
        <th>ë‚ ì§œ</th>
        <th>ë°˜</th>
        <th>ê³¼ëª©</th>
        <th>ë¯¸ì‘ì‹œ</th>
        <th>ë³´ì¶©(ì¼ì‹œ/ì¥)</th>
        <th>ë©”ëª¨</th>
        <th></th>
      </tr>
    </thead>
    <tbody></tbody>
  `;

  const tbody = table.tBodies[0];
  (state.assess || []).forEach(a => addAssessRow(a));
}

// â˜… í‰ê°€ í–‰ ì¶”ê°€: ì‹œê°„/ì¥ì†Œ ì œê±°, ë©”ëª¨ 1ì¹¸ë§Œ ì‚¬ìš©
function addAssessRow(a){
  ensureAssTable?.();
  if (!a.id){ a.id = rid(); (state.assess ||= []).push(a); save(); }

  // â˜… ê°’ ì •ê·œí™”: type / makeup(ê°ì²´ â†’ ë¬¸ìì—´)
  const normType = v =>
    v==="ë‹¨ì›"||v==="ë‹¨ì›í‰ê°€" ? "unit" :
    v==="ìˆ˜í–‰"||v==="ìˆ˜í–‰í‰ê°€" ? "performance" :
    (v==="unit"||v==="performance" ? v : "unit");
  a.type = normType(a.type);

  const makeupVal = (typeof a.makeup === "string")
    ? a.makeup
    : (a.makeup ? `${a.makeup.date||""} ${a.makeup.place||""}`.trim() : "");

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input class="input" data-field="title"  value="${a.title||''}"></td>
    <td>
      <select data-field="type">
        <option value="unit">ë‹¨ì›í‰ê°€</option>
        <option value="performance">ìˆ˜í–‰í‰ê°€</option>
      </select>
    </td>
    <td><input class="input" data-field="scope"  value="${a.scope||''}"></td>
    <td><input class="input" data-field="date"   type="date" value="${a.date||''}"></td>
    <td><input class="input" data-field="class"  value="${a.class||''}"></td>
    <td><input class="input" data-field="subject"value="${a.subject||''}"></td>
    <td><input class="input" data-field="absent" value="${a.absent||''}" placeholder="í™ê¸¸ë™,ê¹€â€¦"></td>
    <td><input class="input" data-field="makeup" value="${makeupVal}" placeholder="ì—°ë„-ì›”-ì¼ / ì¥ì†Œ"></td>
    <td><input class="input" data-field="memo"   value="${a.memo||''}"></td>
    <td><button class="btn" data-field="del">ì‚­ì œ</button></td>
  `;

  document.querySelector("#assTable tbody").appendChild(tr);

  const title  = tr.querySelector('input[data-field="title"]');
  const type   = tr.querySelector('select[data-field="type"]');
  const scope  = tr.querySelector('input[data-field="scope"]');
  const date   = tr.querySelector('input[data-field="date"]');
  const cls    = tr.querySelector('input[data-field="class"]');
  const sub    = tr.querySelector('input[data-field="subject"]');
  const absent = tr.querySelector('input[data-field="absent"]');
  const makeup = tr.querySelector('input[data-field="makeup"]');
  const memo   = tr.querySelector('input[data-field="memo"]');
  const delBtn = tr.querySelector('[data-field="del"]');

  if (type) type.value = a.type;

  const sync = () => {
    if (title)  a.title   = title.value;
    if (type)   a.type    = type.value;
    if (scope)  a.scope   = scope.value;
    if (date)   a.date    = date.value;
    if (cls)    a.class   = cls.value;
    if (sub)    a.subject = sub.value;
    if (absent) a.absent  = absent.value;
    if (makeup) a.makeup  = makeup.value;   // â† í•­ìƒ ë¬¸ìì—´ë¡œ ì €ì¥
    if (memo)   a.memo    = memo.value;
    save(); renderCalendar?.(); drawDash?.();
  };
  [title,type,scope,date,cls,sub,absent,makeup,memo].forEach(el=>{ if(el) el.addEventListener("change", sync); });

  if (delBtn) delBtn.onclick = () => {
    if (confirm("ì‚­ì œí• ê¹Œìš”?")) {
      state.assess = (state.assess||[]).filter(x=>x.id!==a.id);
      save(); renderAssess(); renderCalendar?.(); drawDash?.();
    }
  };
}

/* ---------------- Minimum Achievement ---------------- */
byId("maAdd").onclick=()=> addMArow({mode:"prevention", title:"ë³´ê°• í•™ìŠµ", date:new Date().toISOString().slice(0,10), time:"", class:byId("maClass").value.trim(), subject:byId("maSubject").value.trim(), content:"", participants:"", followup:"", result:{attended:"",retested:"",improved:""}});
byId("maExport").onclick=()=>{
  const rows=[["subject","class","mode","title","date","time","content","participants","followup","attended","retested","improved"]]
    .concat(state.min_achievement.map(m=>[m.subject||"",m.class||"",m.mode||"",m.title||"",m.date||"",m.time||"",m.content||"",m.participants||"",m.followup||"",m.result?.attended||"",m.result?.retested||"",m.result?.improved||""]));
  downloadCSV("min_achievement.csv", rows);
}
byId("maImport").onchange=e=> importCSV(e.target.files?.[0], rows=>{
  rows.slice(1).forEach(r=>{
    if(!r.length) return;
    const [subject,cls,mode,title,date,time,content,participants,followup,attended,retested,improved]=r;
    state.min_achievement.push({ id:rid(), subject, class:cls, mode, title, date, time, content, participants, followup, result:{attended, retested, improved} });
  });
  save(); renderMinAchv(); toast("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ","ë³´ì¥ì§€ë„ ë°ì´í„° ë°˜ì˜");
});
// â”€â”€ (A) ë³´ì¥ì§€ë„ í‘œê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ ë¶™ì´ëŠ” ìê°€ì¹˜ìœ  í•¨ìˆ˜ â”€â”€
function ensureMaTable(){
  if (document.getElementById("maTable")) return; // ì´ë¯¸ ìˆìœ¼ë©´ íŒ¨ìŠ¤

  // "ë³´ì¥ì§€ë„" ì„¹ì…˜ ì¶”ì • í˜¸ìŠ¤íŠ¸ ì°¾ê¸° (ê°€ëŠ¥í•œ í›„ë³´ë“¤ ìˆœíšŒ)
  const host =
    document.getElementById("minAchvSection") ||
    document.getElementById("minAchv") ||
    document.getElementById("maSection") ||
    document.getElementById("section-min") ||
    (document.querySelector('[data-target="min"]') && document.querySelector('[data-target="min"]').closest('section')) ||
    document.querySelector('section#min') ||
    document.body; // ìµœí›„ì˜ ë³´ë£¨: ë°”ë”” ë

  // ë˜í¼ + í…Œì´ë¸” ì‚½ì…
  const wrap = document.createElement("div");
  wrap.id = "maTable-wrapper";
  wrap.innerHTML = `
    <table id="maTable" class="table" style="margin-top:10px; width:100%">
      <thead>
        <tr>
          <th>ëª¨ë“œ</th>
          <th>ì œëª©</th>
          <th>ë‚ ì§œ</th>
          <th>ë°˜</th>
          <th>ê³¼ëª©</th>
          <th>ë‚´ìš©</th>
          <th>ëŒ€ìƒ</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  `;
  // ì»¨íŠ¸ë¡¤(ê³¼ëª©/ë°˜ ì„ íƒ, ì„¸ì…˜ì¶”ê°€ ë²„íŠ¼) ë¸”ë¡ì´ ìˆìœ¼ë©´ ê·¸ ë°”ë¡œ ë’¤ì—, ì—†ìœ¼ë©´ ì„¹ì…˜ ë§¨ ëì—
  const anchor = document.getElementById("maControls") || host;
  anchor.appendChild(wrap);
}
// â”€â”€ (B) ë Œë” í•¨ìˆ˜: í‘œ ë³´ì¥ â†’ í•„í„°/ì •ë ¬ â†’ í–‰ ì¶”ê°€ â”€â”€
function renderMinAchv(){
  // í‘œ ë³´ì¥(ì—†ìœ¼ë©´ ìƒì„±)
  ensureMaTable?.();

  const table = document.getElementById("maTable");
  if (!table) return;

  // â‘  í—¤ë”ë¥¼ í•­ìƒ 8ì—´ êµ¬ì¡°ë¡œ **ê°•ì œ ì¬êµ¬ì„±**
  const thead = table.tHead || table.createTHead();
  thead.innerHTML = `
    <tr>
      <th>ëª¨ë“œ</th>
      <th>ì œëª©</th>
      <th>ë‚ ì§œ</th>
      <th>ë°˜</th>
      <th>ê³¼ëª©</th>
      <th>ë‚´ìš©</th>
      <th>ëŒ€ìƒ</th>
      <th></th>
    </tr>
  `;

  // â‘¡ ë°”ë”” ë¹„ìš°ê³  ë‹¤ì‹œ ê·¸ë¦¼
  const tbody = table.tBodies[0] || table.createTBody();
  tbody.innerHTML = "";

  const s = byId("maSubject") ? byId("maSubject").value.trim() : "";
  const c = byId("maClass")   ? byId("maClass").value.trim()   : "";

  (state.min_achievement || [])
    .filter(m => (!s || m.subject === s) && (!c || m.class === c))
    .sort((a,b)=> new Date(a.date||"2100-01-01") - new Date(b.date||"2100-01-01"))
    .forEach(m => addMArow(m, true));
}

// â”€â”€ (C) í–‰ ì¶”ê°€ í•¨ìˆ˜: (ì‹œê°„/í›„ì†/ì°¸ì—¬/ì¬í‰ê°€/ê°œì„  ì œê±° + 'ëŒ€ìƒ' í™•ì¥ êµ¬ì¡°) â”€â”€
function addMArow(m, append = false){
  ensureMaTable();

  if (!m.id) { m.id = rid(); (state.min_achievement ||= []).push(m); save(); }

  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>
      <select data-field="mode">
        <option value="prevention">ì˜ˆë°©</option>
        <option value="remediation">ë³´ì¶©</option>
      </select>
    </td>
    <td><input class="input" data-field="title"   value="${m.title||''}"></td>
    <td><input class="input" data-field="date"    type="date" value="${m.date||''}"></td>
    <td><input class="input" data-field="class"   value="${m.class||''}"></td>
    <td><input class="input" data-field="subject" value="${m.subject||''}"></td>
    <td><input class="input" data-field="content" value="${m.content||''}"></td>
    <td><input class="input" data-field="participants" value="${m.participants||''}" placeholder="ì „ì›/ì¼ë¶€/Nëª…"></td>
    <td><button class="btn" data-field="del">ì‚­ì œ</button></td>
  `;

  // í…Œì´ë¸”ì— ë¨¼ì € ë¶™ì„
  const tbody = document.querySelector("#maTable tbody");
  if (tbody) tbody.appendChild(tr);

  // ìš”ì†Œ ì°¸ì¡°
  const modeSel = tr.querySelector('select[data-field="mode"]');
  const title   = tr.querySelector('input[data-field="title"]');
  const date    = tr.querySelector('input[data-field="date"]');
  const cls     = tr.querySelector('input[data-field="class"]');
  const sub     = tr.querySelector('input[data-field="subject"]');
  const content = tr.querySelector('input[data-field="content"]');
  const part    = tr.querySelector('input[data-field="participants"]');
  const delBtn  = tr.querySelector('[data-field="del"]');

  // ì´ˆê¸°ê°’ ì •ê·œí™” + í‘œì‹œ
  if (m.mode === "ì˜ˆë°©") m.mode = "prevention";
  if (m.mode === "ë³´ì¶©") m.mode = "remediation";
  if (!m.mode) m.mode = "prevention";
  if (modeSel) { modeSel.value = m.mode; }

  // ë™ê¸°í™” (changeë§Œ)
  const sync = () => {
    if (modeSel) m.mode         = modeSel.value;
    if (title)   m.title        = title.value;
    if (date)    m.date         = date.value;
    if (cls)     m.class        = cls.value;
    if (sub)     m.subject      = sub.value;
    if (content) m.content      = content.value;
    if (part)    m.participants = part.value;

    // ê³¼ê±° ë°ì´í„° í˜¸í™˜(ì‚­ì œí•œ í•„ë“œ ì œê±°)
    delete m.time; delete m.followup; delete m.result;

    save(); renderCalendar(); drawDash();
  };
  [modeSel, title, date, cls, sub, content, part].forEach(el => { if (el) el.addEventListener("change", sync); });

  // ì‚­ì œ
  if (delBtn) delBtn.onclick = () => {
    if (confirm("ì‚­ì œí• ê¹Œìš”?")) {
      state.min_achievement = (state.min_achievement||[]).filter(x => x.id !== m.id);
      save(); renderMinAchv(); renderCalendar(); drawDash();
    }
  };
}

/* ---------------- Simple charts ---------------- */
function drawBar(ctx, labels, data){
  const w=ctx.canvas.width=ctx.canvas.clientWidth*devicePixelRatio;
  const h=ctx.canvas.height=ctx.canvas.clientHeight*devicePixelRatio;
  ctx.clearRect(0,0,w,h);
  const padding=40*devicePixelRatio;
  const maxVal=Math.max(1,...data);
  const bw=(w-padding*2)/data.length*0.6;
  const gap=(w-padding*2)/data.length*0.4;
  const style=getComputedStyle(document.body);
  ctx.strokeStyle=style.getPropertyValue('--border'); ctx.fillStyle=style.getPropertyValue('--text'); ctx.lineWidth=1*devicePixelRatio;
  ctx.beginPath(); ctx.moveTo(padding,h-padding); ctx.lineTo(w-padding,h-padding); ctx.moveTo(padding,h-padding); ctx.lineTo(padding,padding); ctx.stroke();
  const accent=style.getPropertyValue('--accent').trim();
  for(let i=0;i<data.length;i++){
    const x=padding+i*(bw+gap);
    const y=(h-padding)-(data[i]/maxVal)*(h-padding*2);
    ctx.fillStyle=accent; ctx.fillRect(x,y,bw,(h-padding)-y);
    ctx.fillStyle=style.getPropertyValue('--text'); ctx.font=`${12*devicePixelRatio}px system-ui, sans-serif`;
    ctx.fillText(String(data[i]), x, y-6*devicePixelRatio);
    ctx.fillText(labels[i]||"", x, h-padding+14*devicePixelRatio);
  }
}

/* ---------------- Settings ---------------- */
byId("exportJSON").onclick=()=>{ const a=document.createElement("a"); a.href="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(state,null,2)); a.download="backup.json"; a.click(); }
byId("importJSON").onchange=async e=>{
  const f=e.target.files?.[0]; if(!f) return; const txt=await f.text();
  try{ const next=JSON.parse(txt); state=Object.assign(defaultState(), next); save(); initAll(); toast("ë³µì› ì™„ë£Œ"); }catch(err){ toast("ë³µì› ì‹¤íŒ¨", String(err)) }
}
byId("resetAll").onclick=()=>{ if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")){ state=defaultState(); save(); initAll(); toast("ì´ˆê¸°í™” ì™„ë£Œ") } }

/* ---------------- Init ---------------- */
function initAll(){
  setPreset(state.settings.preset || "classic");
  toggleDark(!!state.settings.dark);
  applyHue(state.settings.hue ?? 30);

  drawDash(); renderCalendar(); renderKanban(); renderFiles();
  renderProgress(); renderPlans(); renderAssess(); renderMinAchv();

  // ê¸°ë³¸ í™œì„± ì„¹ì…˜
  document.querySelectorAll("section").forEach(s=> s.classList.remove("active"));
  byId("dash").classList.add("active");
  document.querySelectorAll("[data-target]").forEach(b=> b.classList.remove("active"));
  document.querySelectorAll("[data-target='dash']").forEach(b=> b.classList.add("active"));

  ensureMaTable();
  renderMinAchv();
}   

// =================== ì´ˆê¸° í™œì„± ì„¹ì…˜ ì„¤ì • & ì´ˆê¸°í™” í˜¸ì¶œ ===================
function setDefaultActive(){
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  byId("dash").classList.add("active");
  document.querySelectorAll("[data-target]").forEach(b => b.classList.remove("active"));
  document.querySelectorAll("[data-target='dash']").forEach(b => b.classList.add("active"));
}

setDefaultActive();
initAll();
</script>
<script>
(function(){
  // í‘œì˜ í—¤ë” í…ìŠ¤íŠ¸ë¥¼ ê° ì…€ì˜ data-labelì— ì±„ì›Œ ë„£ì–´ ëª¨ë°”ì¼ ì¹´ë“œí™”
  function hydrateResponsiveTables(){
    document.querySelectorAll('table.responsive').forEach(table=>{
      const headers = Array.from(table.querySelectorAll('thead th')).map(th=>th.textContent.trim());
      table.querySelectorAll('tbody tr').forEach(tr=>{
        Array.from(tr.children).forEach((td, i)=>{
          if(!td.hasAttribute('data-label')) td.setAttribute('data-label', headers[i] || '');
        });
      });
      // ê°€ë¡œ ìŠ¤í¬ë¡¤ ë˜í¼ê°€ ì—†ìœ¼ë©´ ê°ì‹¸ê¸°
      if(!table.parentElement.classList.contains('table-wrap')){
        const wrap = document.createElement('div');
        wrap.className = 'table-wrap';
        table.replaceWith(wrap);
        wrap.appendChild(table);
      }
    });
  }

  // ê°€ë¡œ í•„í„°/ë²„íŠ¼ ë°”ì— .h-scroll ë¶€ì—¬ (ì„ íƒì ìœ¼ë¡œ í´ë˜ìŠ¤ëª… êµì²´)
  function enhanceHorizontalBars(){
    document.querySelectorAll('.filters, .toolbar, .chips, .actions-bar').forEach(el=>{
      el.classList.add('h-scroll');
    });
  }

  // í•˜ë‹¨ íƒ­ë°” ìƒì„± (ì›í•œë‹¤ë©´)
  function mountTabbar(){
    if(document.querySelector('.tabbar')) return;
    const tabs = [
      {id:'dashboard', label:'ëŒ€ì‹œë³´ë“œ', emoji:'ğŸ '},
      {id:'schedule',  label:'ì¼ì •',     emoji:'ğŸ“…'},
      {id:'tasks',     label:'ì—…ë¬´',     emoji:'ğŸ—‚ï¸'},
      {id:'library',   label:'ìë£Œì‹¤',   emoji:'ğŸ“'},
      {id:'plan',      label:'ì§„ë„',     emoji:'ğŸ“˜'},
      {id:'assess',    label:'í‰ê°€',     emoji:'âœ…'},
      {id:'settings',  label:'ì„¤ì •',     emoji:'âš™ï¸'},
    ];
    const bar = document.createElement('nav');
    bar.className='tabbar safe-bottom';
    bar.innerHTML = '<ul>' + tabs.map(t=>(
      `<li><a href="#${t.id}" aria-label="${t.label}"><span>${t.emoji}</span><small>${t.label}</small></a></li>`
    )).join('') + '</ul>';
    document.body.appendChild(bar);
  }

  function run(){
    hydrateResponsiveTables();
    enhanceHorizontalBars();
    mountTabbar();
  }
  document.readyState!=='loading' ? run() : document.addEventListener('DOMContentLoaded', run);
})();
</script>
</body>

</html>





